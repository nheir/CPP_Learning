<!doctype html><html lang=fr dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 7.0.1+72a875f1db967152c77914cff4d53f8fcee0e619"><meta name=description content="Jusqu‚Äôici, nous vous avons expliqu√© que contrairement au Java, les donn√©es que vous instanciez ne restent pas magiquement en vie tant que vous en avez besoin.
C‚Äôest donc √† vous de garantir que vos donn√©es ne seront pas d√©sinstanci√©es avant d‚Äôavoir fini de les utiliser.
Sur cette page, nous allons introduire le concept d‚Äôownership, qui vous aidera √† mieux architecturer votre code pour √©viter de vous retrouver avec des dangling-references."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Ownership üèòÔ∏è :: Cours de C++ - Niveau Master"><meta name=twitter:description content="Jusqu‚Äôici, nous vous avons expliqu√© que contrairement au Java, les donn√©es que vous instanciez ne restent pas magiquement en vie tant que vous en avez besoin.
C‚Äôest donc √† vous de garantir que vos donn√©es ne seront pas d√©sinstanci√©es avant d‚Äôavoir fini de les utiliser.
Sur cette page, nous allons introduire le concept d‚Äôownership, qui vous aidera √† mieux architecturer votre code pour √©viter de vous retrouver avec des dangling-references."><meta property="og:url" content="/chapter3/5-ownership/index.html"><meta property="og:site_name" content="Cours de C++ - Niveau Master"><meta property="og:title" content="Ownership üèòÔ∏è :: Cours de C++ - Niveau Master"><meta property="og:description" content="Jusqu‚Äôici, nous vous avons expliqu√© que contrairement au Java, les donn√©es que vous instanciez ne restent pas magiquement en vie tant que vous en avez besoin.
C‚Äôest donc √† vous de garantir que vos donn√©es ne seront pas d√©sinstanci√©es avant d‚Äôavoir fini de les utiliser.
Sur cette page, nous allons introduire le concept d‚Äôownership, qui vous aidera √† mieux architecturer votre code pour √©viter de vous retrouver avec des dangling-references."><meta property="og:locale" content="fr"><meta property="og:type" content="article"><meta property="article:section" content="Cycle de vie"><meta itemprop=name content="Ownership üèòÔ∏è :: Cours de C++ - Niveau Master"><meta itemprop=description content="Jusqu‚Äôici, nous vous avons expliqu√© que contrairement au Java, les donn√©es que vous instanciez ne restent pas magiquement en vie tant que vous en avez besoin.
C‚Äôest donc √† vous de garantir que vos donn√©es ne seront pas d√©sinstanci√©es avant d‚Äôavoir fini de les utiliser.
Sur cette page, nous allons introduire le concept d‚Äôownership, qui vous aidera √† mieux architecturer votre code pour √©viter de vous retrouver avec des dangling-references."><meta itemprop=wordCount content="1811"><title>Ownership üèòÔ∏è :: Cours de C++ - Niveau Master</title>
<link href=../../css/fontawesome-all.min.css?1729268597 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../css/fontawesome-all.min.css?1729268597 rel=stylesheet></noscript><link href=../../css/nucleus.css?1729268597 rel=stylesheet><link href=../../css/auto-complete.css?1729268597 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../css/auto-complete.css?1729268597 rel=stylesheet></noscript><link href=../../css/perfect-scrollbar.min.css?1729268597 rel=stylesheet><link href=../../css/fonts.css?1729268597 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../css/fonts.css?1729268597 rel=stylesheet></noscript><link href=../../css/theme.css?1729268597 rel=stylesheet><link href=../../css/theme-mine.css?1729268597 rel=stylesheet id=R-variant-style><link href=../../css/chroma-relearn-light.css?1729268597 rel=stylesheet id=R-variant-chroma-style><link href=../../css/print.css?1729268597 rel=stylesheet media=print><script src=../../js/variant.js?1729268597></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../..",window.relearn.relBaseUri="../..",window.relearn.absBaseUri="",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.variants&&variants.init(["mine"]),window.T_Copy_to_clipboard=`Copier dans le presse-papiers`,window.T_Copied_to_clipboard=`Copi√© dans le presse-papiers!`,window.T_Copy_link_to_clipboard=`Copier le lien dans le presse-papiers`,window.T_Link_copied_to_clipboard=`Lien copi√© dans le presse-papiers!`,window.T_Reset_view=`R√©initialiser la vue`,window.T_View_reset=`Vue r√©initialis√©e!`,window.T_No_results_found=`Aucun r√©sultat trouv√© pour "{0}"`,window.T_N_results_found=`{1} r√©sultats trouv√©s pour "{0}"`</script></head><body class="mobile-support html disableInlineCopyToClipboard" data-url=../../chapter3/5-ownership/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table des mati√®res (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><ul><li><a href=#cest-quoi-lownership->C&rsquo;est quoi l&rsquo;ownership ?</a></li><li><a href=#exercices-pratiques>Exercices pratiques</a></li><li><a href=#synth√®se>Synth√®se</a></li></ul></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../index.html><span itemprop=name>Accueil</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../chapter3/index.html><span itemprop=name>Cycle de vie</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Ownership üèòÔ∏è</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=../../chapter3/4-references/index.html title="Usage des r√©f√©rences üîÄ (ü°ê)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=../../chapter3/test/index.html title="Questionnaire ‚òë (ü°í)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Aller plus loin"><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable chapter3" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=ownership->Ownership üèòÔ∏è</h1><p>Jusqu&rsquo;ici, nous vous avons expliqu√© que contrairement au Java, les donn√©es que vous instanciez ne restent pas magiquement en vie tant que vous en avez besoin.<br>C&rsquo;est donc √† vous de garantir que vos donn√©es ne seront pas d√©sinstanci√©es avant d&rsquo;avoir fini de les utiliser.<br>Sur cette page, nous allons introduire le concept d&rsquo;<strong>ownership</strong>, qui vous aidera √† mieux architecturer votre code pour √©viter de vous retrouver avec des dangling-references.</p><hr><h3 id=cest-quoi-lownership->C&rsquo;est quoi l&rsquo;ownership ?</h3><p>Litt√©ralement, <strong>ownership</strong> signifie <strong>propri√©t√©</strong> (au sens de la possession de quelque chose).</p><p>En pratique, dans le domaine de la programmation, le <strong>owner</strong> (ou le <strong>propri√©taire</strong>) d&rsquo;une donn√©e est l&rsquo;√©l√©ment qui a la responsabilit√© de la d√©sinstancier une fois qu&rsquo;elle n&rsquo;est plus utile au programme.</p><p>Nous allons vous montrer quelques exemples, afin que vous puissiez un peu mieux comprendre ce concept assez abstrait.<br>Au fur-et-√†-mesure des exemples, nous √©tablirons le <strong>graphe d&rsquo;ownership</strong> correspondant, c&rsquo;est-√†-dire la repr√©sentation graphique illustrant les relations d&rsquo;ownership pr√©sentes au sein du programme.</p><h4 id=variable-locale>Variable locale</h4><p>Une variable locale est d√©sinstanci√©e lorsqu&rsquo;on sort du bloc dans lequel elle est d√©finie.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>void</span> <span class=nf>fcn</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Dans l&rsquo;exemple ci-dessus, <code>a</code> est d√©sinstanci√©e √† la sortie de <code>fcn</code>.<br>On pourra donc dire que la donn√©e port√©e par <code>a</code> est own√©e par la fonction <code>fcn</code>, ou encore que <code>fcn</code> own <code>a</code>.</p><p><a href=#R-image-39d9068b8b5122b236a312bd84a41202 class=lightbox-link><img alt="Variable locale" class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../images/chapter3/ownership/01-local-var.svg style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-39d9068b8b5122b236a312bd84a41202><img alt="Variable locale" class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../images/chapter3/ownership/01-local-var.svg></a></p><h4 id=attribut-valeur>Attribut-valeur</h4><p>La donn√©e port√©e par un attribut-valeur est d√©sinstanci√©e lorsque l&rsquo;instance de la classe est d√©truite.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>MyStruct</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>value</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>MyStruct</span> <span class=n>s</span> <span class=p>{</span> <span class=mi>5</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Ici, la donn√©e port√©e par l&rsquo;attribut <code>value</code> de l&rsquo;instance <code>s</code> est own√©e par <code>s</code>.<br>On peut dire plus simplement que <code>s</code> own <code>s.value</code>.</p><p><a href=#R-image-ae43fe794755e5b09fe4bad9c67397d0 class=lightbox-link><img alt=Attribut-valeur class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../images/chapter3/ownership/02-value-attribute.svg style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ae43fe794755e5b09fe4bad9c67397d0><img alt=Attribut-valeur class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../images/chapter3/ownership/02-value-attribute.svg></a></p><h4 id=attribut-r√©f√©rence>Attribut-r√©f√©rence</h4><p>Ici, √ßa devient un peu plus compliqu√© !</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Driver</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Car</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Driver</span><span class=o>&amp;</span> <span class=n>driver</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Driver</span> <span class=n>gontrand</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Car</span> <span class=n>clio</span> <span class=p>{</span> <span class=n>gontrand</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>La donn√©e port√©e par <code>clio.driver</code> correspond √† la variable <code>gontrand</code> d√©finie dans le <code>main</code>.<br>Le owner de <code>clio.driver</code> n&rsquo;est donc pas <code>clio</code>, puisque la destruction de <code>clio</code> n&rsquo;entrainera pas la destruction de <code>gontrand</code>.<br>Dans ce cas pr√©cis, c&rsquo;est la fonction <code>main</code> qui own le contenu de <code>clio.driver</code>.</p><p><a href=#R-image-250a480fd1ec90e39a52064bb44c8bfe class=lightbox-link><img alt=Attribut-r√©f√©rence class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../images/chapter3/ownership/03-ref-attribute.svg style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-250a480fd1ec90e39a52064bb44c8bfe><img alt=Attribut-r√©f√©rence class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../images/chapter3/ownership/03-ref-attribute.svg></a></p><h4 id=ressources-g√©r√©es-par-une-classe>Ressources g√©r√©es par une classe</h4><p>Lorsque le cycle de vie d&rsquo;une ressource (m√©moire, fichier, connexion r√©seau, etc) stock√©e √† l&rsquo;int√©rieur d&rsquo;un objet est orchestr√© par les fonctions-membres de cet objet, alors ces ressources sont own√©es par l&rsquo;objet.</p><p>Prenons ici l&rsquo;exemple d&rsquo;un <code>std::vector</code>.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>Driver</span><span class=o>&gt;</span> <span class=n>drivers</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>drivers</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>drivers</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>drivers</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>();</span></span></span></code></pre></div><p>Chacun des <code>Driver</code> faisant partie du tableau est stock√© sur un segment-m√©moire allou√© dynamiquement par l&rsquo;objet <code>drivers</code>.<br>Ce segment sera lib√©r√© √† la destruction de <code>drivers</code> (ou plus t√¥t, en fonction des fonctions qu&rsquo;on appelera sur l&rsquo;objet), entra√Ænant la d√©sinstanciation des <code>Drivers</code>.<br>On peut donc dire que <code>drivers</code> own chacun des √©l√©ments de type <code>Driver</code> ajout√©s via l&rsquo;appel √† <code>emplace_back</code>.</p><p><a href=#R-image-b23b8339ffd1ad3768359ed040d38827 class=lightbox-link><img alt=std::vector class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../images/chapter3/ownership/04-vector.svg style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-b23b8339ffd1ad3768359ed040d38827><img alt=std::vector class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../images/chapter3/ownership/04-vector.svg></a></p><h4 id=pointeur-ownant>Pointeur-ownant</h4><p>Si on consid√®re qu&rsquo;un pointeur est responsable du cyle de vie de la donn√©e point√©e, on parlera de <strong>pointeurs-ownants</strong>.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span><span class=o>*</span> <span class=nf>create_int</span><span class=p>(</span><span class=kt>int</span> <span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>auto</span><span class=o>*</span> <span class=n>ptr</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>int</span> <span class=p>{</span> <span class=n>value</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>auto</span><span class=o>*</span> <span class=n>five</span> <span class=o>=</span> <span class=n>create_int</span><span class=p>(</span><span class=mi>5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=o>*</span><span class=n>five</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>    <span class=k>delete</span> <span class=n>five</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Dans le code ci-dessus, √† l&rsquo;int√©rieur de la fonction <code>create_int</code>, <code>ptr</code> est un pointeur-ownant.<br>En effet, on l&rsquo;a d√©fini dans l&rsquo;objectif de stocker l&rsquo;adresse d&rsquo;un bloc m√©moire fra√Æchement allou√© pour stocker un entier.
Il est par cons√©quent responsable du cycle de vie de cet entier.<br>Comme <code>ptr</code> est la valeur de retour de <code>create_int</code>, cette responsabilit√© est transmise √† <code>five</code> au retour dans la fonction <code>main</code>, faisant de lui un pointeur-ownant.<br>La responsabilit√© de la d√©sinstanciation de l&rsquo;entier √©tant attribu√© √† <code>five</code>, on a pens√© √† ex√©cuter <code>delete five</code> avant de sortir du <code>main</code>.</p><p><a href=#R-image-8654c57b38fd2bbfdfd3763b0c4dade3 class=lightbox-link><img alt=Pointeur-ownant class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../images/chapter3/ownership/05-owning-ptr.svg style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-8654c57b38fd2bbfdfd3763b0c4dade3><img alt=Pointeur-ownant class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../images/chapter3/ownership/05-owning-ptr.svg></a></p><h4 id=pointeur-observant>Pointeur-observant</h4><p>Un <strong>pointeur-observant</strong> est un pointeur qui n&rsquo;est pas ownant. Ils servent simplement √† r√©f√©rencer des donn√©es pr√©-existantes.</p><p>Mais du coup, vous devez vous demander quel est leur int√©r√™t, sachant qu&rsquo;on a d√©j√† les r√©f√©rences&mldr;<br>Eh bien les r√©f√©rences ne permettent pas de faire autant de choses que les pointeurs.<br>Par exemple, vous ne pouvez pas cr√©er de r√©f√©rence qui ne r√©f√©rence rien, alors qu&rsquo;un pointeur peut √™tre vide :</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span><span class=o>&amp;</span> <span class=n>ref_on_nothing</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// =&gt; A√Øe, √ßa compile pas
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span><span class=o>*</span> <span class=n>ptr_on_nothing</span> <span class=o>=</span> <span class=k>nullptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// =&gt; Ok
</span></span></span></code></pre></div><p>Une fois une r√©f√©rence d√©finie, celle-ci r√©f√©rencera la m√™me donn√©e pour toujours, tandis qu&rsquo;un pointeur est r√©assignable :</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span><span class=o>&amp;</span> <span class=n>ref</span> <span class=o>=</span> <span class=n>data_1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>ref</span> <span class=o>=</span> <span class=n>data_2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// =&gt; ref fait toujours r√©f√©rence √† data_1, le contenu de data_2 a simplement √©t√© assign√© √† data_1 
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>int</span><span class=o>*</span> <span class=n>ptr</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>data_1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>ptr</span> <span class=o>=</span> <span class=o>&amp;</span><span class=n>data_2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// =&gt; data_1 n&#39;a pas chang√© et ptr pointe d√©sormais sur data_2
</span></span></span></code></pre></div><p>Sachant qu&rsquo;un pointeur-observant ne own pas son contenu, comment pourriez-vous dessiner le graphe d&rsquo;ownership du programme suivant, une fois arriv√© √† la ligne 8 :</p><div class="highlight wrap-code" linenos=table><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>auto</span> <span class=n>toto</span> <span class=o>=</span> <span class=n>Driver</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>    <span class=k>auto</span> <span class=n>jacquot</span> <span class=o>=</span> <span class=n>Driver</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>    <span class=k>auto</span> <span class=n>leon</span> <span class=o>=</span> <span class=n>Driver</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=k>auto</span> <span class=n>all_drivers</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=k>const</span> <span class=n>Driver</span><span class=o>*&gt;</span> <span class=p>{</span> <span class=o>&amp;</span><span class=n>toto</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>jacquot</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>leon</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><br><div class=hidden-solution><button class=show-solution-btn onclick='this.classList.add("off"),this.nextElementSibling.classList.remove("off")'>
‚Æü Afficher la solution ‚Æü</button><div class=off><button class=hide-solution-btn onclick='this.parentElement.classList.add("off"),this.parentElement.previousElementSibling.classList.remove("off")'>
‚Æù Masquer la solution ‚Æù</button><div class=hidden-solution-content><p>Les √©l√©ments de <code>all_drivers</code> √©tant des pointeurs, on utilise un contour plein pour les cases du tableau.<br>En revanche, comme ces pointeurs ne contr√¥lent pas le cycle de vie de chacun des <code>Drivers</code>, on les relie vers eux avec des fl√®ches en pointill√©.
<a href=#R-image-55072448ec251cb26c0b6d6fc140c10b class=lightbox-link><img alt=Pointeur-observant class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../images/chapter3/ownership/06-observing-ptr.svg style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-55072448ec251cb26c0b6d6fc140c10b><img alt=Pointeur-observant class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../images/chapter3/ownership/06-observing-ptr.svg></a></p></div></div></div><hr><h3 id=exercices-pratiques>Exercices pratiques</h3><p>Nous allons maintenant vous pr√©senter quelques petits bouts de code.<br>Vous devrez dessiner le graphe d&rsquo;ownership correspondant √† l&rsquo;√©tat du programme aux instructions indiqu√©es, et en d√©duire les √©ventuels probl√®mes s&rsquo;il y en a.<br>Si vous souhaitez dessiner vos graphes sur ordinateur, vous pouvez utiliser <a href=https://app.diagrams.net/ rel=external target=_blank>draw.io</a>.</p><p>Pour cela, vous pourrez vous appuyer sur les r√®gles d&rsquo;architecture suivantes :</p><ul><li>Chaque donn√©e a un seul et unique owner (=> une unique fl√®che pleine arrive sur chaque case)</li><li>Toutes les r√©f√©rences m√®nent √† une donn√©e valide (=> pas de fl√®che qui pointe sur une case rouge)</li><li>Si un pointeur est ownant, sa donn√©e sera correctement lib√©r√©e <strong>ou bien</strong> il transf√®rera l&rsquo;ownership √† un autre pointeur (pas les deux)</li></ul><h4 id=cas-n1>Cas n¬∞1</h4><div class="highlight wrap-code" linenos=table><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span><span class=o>&amp;</span> <span class=n>get_max</span><span class=p>(</span><span class=kt>int</span><span class=o>&amp;</span> <span class=n>a</span><span class=p>,</span> <span class=kt>int</span><span class=o>&amp;</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>a</span> <span class=o>&lt;</span> <span class=n>b</span> <span class=o>?</span> <span class=nl>a</span> <span class=p>:</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span>  <span class=n>v1</span> <span class=o>=</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span>  <span class=n>v2</span> <span class=o>=</span> <span class=mi>6</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span><span class=o>&amp;</span> <span class=n>max</span> <span class=o>=</span> <span class=n>get_max</span><span class=p>(</span><span class=n>v1</span><span class=p>,</span> <span class=n>v2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>max</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><ol><li><p>Dessinez le graphe d&rsquo;ownership √† la ligne 3, lorsque le <code>main</code> vient d&rsquo;appeler <code>get_max</code>.<div class=hidden-solution><button class=show-solution-btn onclick='this.classList.add("off"),this.nextElementSibling.classList.remove("off")'>
‚Æü Afficher la solution ‚Æü</button><div class=off><button class=hide-solution-btn onclick='this.parentElement.classList.add("off"),this.parentElement.previousElementSibling.classList.remove("off")'>
‚Æù Masquer la solution ‚Æù</button><div class=hidden-solution-content><p><a href=#R-image-fd2fffe9c7f8bed1ec5e3b9dfe54af23 class=lightbox-link><img class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../images/chapter3/ownership/07-case-1a.svg style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-fd2fffe9c7f8bed1ec5e3b9dfe54af23><img class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../images/chapter3/ownership/07-case-1a.svg></a></p></div></div></div></p></li><li><p>Dessinez maintenant le graphe d&rsquo;ownership associ√© au retour de la fonction <code>get_max</code> dans le <code>main</code>.<br><div class=hidden-solution><button class=show-solution-btn onclick='this.classList.add("off"),this.nextElementSibling.classList.remove("off")'>
‚Æü Afficher la solution ‚Æü</button><div class=off><button class=hide-solution-btn onclick='this.parentElement.classList.add("off"),this.parentElement.previousElementSibling.classList.remove("off")'>
‚Æù Masquer la solution ‚Æù</button><div class=hidden-solution-content><p>Il faut faire pointer la variable-r√©f√©rence <code>max</code> sur <code>v2</code>, et non sur <code>b</code>.<br>En effet, <code>b</code> n&rsquo;est pas une donn√©e, juste un alias, on ne peut donc pas faire pointer une r√©f√©rence dessus.
<a href=#R-image-22955c6086fefab3d17736e4e235139f class=lightbox-link><img class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../images/chapter3/ownership/07-case-1b.svg style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-22955c6086fefab3d17736e4e235139f><img class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../images/chapter3/ownership/07-case-1b.svg></a></p></div></div></div></p></li><li><p>Redessinez le graphe correspondant au retour de la fonction <code>get_max</code>, mais en supposant que <code>get_max</code> attende ses param√®tres par valeur.
Le r√©sultat est par contre toujours retourn√© par r√©f√©rence.<div class=hidden-solution><button class=show-solution-btn onclick='this.classList.add("off"),this.nextElementSibling.classList.remove("off")'>
‚Æü Afficher la solution ‚Æü</button><div class=off><button class=hide-solution-btn onclick='this.parentElement.classList.add("off"),this.parentElement.previousElementSibling.classList.remove("off")'>
‚Æù Masquer la solution ‚Æù</button><div class=hidden-solution-content><p>Les param√®tres <code>a</code> et <code>b</code> sont maintenant des donn√©es.<br>La variable-r√©f√©rence <code>max</code> pointera donc sur <code>b</code> et plus sur <code>v2</code>.
<a href=#R-image-144cb7a57a247676db7b5e9ec7cb7c24 class=lightbox-link><img class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../images/chapter3/ownership/07-case-1c.svg style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-144cb7a57a247676db7b5e9ec7cb7c24><img class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../images/chapter3/ownership/07-case-1c.svg></a></p></div></div></div></p></li><li><p>Quel probl√®me est mis en avant par ce graphe ?<div class=hidden-solution><button class=show-solution-btn onclick='this.classList.add("off"),this.nextElementSibling.classList.remove("off")'>
‚Æü Afficher la solution ‚Æü</button><div class=off><button class=hide-solution-btn onclick='this.parentElement.classList.add("off"),this.parentElement.previousElementSibling.classList.remove("off")'>
‚Æù Masquer la solution ‚Æù</button><div class=hidden-solution-content><p>On a une r√©f√©rence qui pointe sur une donn√©e qui √©t√© d√©sinstanci√©e : il s&rsquo;agit d&rsquo;une dangling-reference.<br>Or cette r√©f√©rence est utilis√©e ligne 12, on a donc un undefined behavior&mldr;</p></div></div></div></p></li></ol><h4 id=cas-n2>Cas n¬∞2</h4><div class="highlight wrap-code" linenos=table><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Animal</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>ManyAnimals</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>~</span><span class=n>ManyAnimals</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=k>auto</span><span class=o>*</span> <span class=nl>a</span><span class=p>:</span> <span class=n>animals</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>delete</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>Animals</span><span class=o>*&gt;</span> <span class=n>animals</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>display_animals</span><span class=p>(</span><span class=n>ManyAnimals</span> <span class=n>many_animals</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=k>auto</span><span class=o>*</span> <span class=nl>a</span><span class=p>:</span> <span class=n>many_animals</span><span class=p>.</span><span class=n>animals</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>a</span><span class=o>-&gt;</span><span class=n>name</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ManyAnimals</span> <span class=n>many_animals</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>many_animals</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=k>new</span> <span class=n>Animal</span> <span class=p>{</span> <span class=s>&#34;dog&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=n>many_animals</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=k>new</span> <span class=n>Animal</span> <span class=p>{</span> <span class=s>&#34;cat&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=n>many_animals</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=k>new</span> <span class=n>Animal</span> <span class=p>{</span> <span class=s>&#34;mouse&#34;</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// display_animals(many_animals);
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><ol><li><p>√âtablissez le graphe d&rsquo;ownership du programme √† la ligne 33.<br>Selon-vous, les pointeurs contenus dans <code>ManyAnimals::animals</code> sont-ils ownants ou observants ?<div class=hidden-solution><button class=show-solution-btn onclick='this.classList.add("off"),this.nextElementSibling.classList.remove("off")'>
‚Æü Afficher la solution ‚Æü</button><div class=off><button class=hide-solution-btn onclick='this.parentElement.classList.add("off"),this.parentElement.previousElementSibling.classList.remove("off")'>
‚Æù Masquer la solution ‚Æù</button><div class=hidden-solution-content><p>Le destructeur de <code>ManyAnimals</code> se charge de lib√©rer la m√©moire associ√©e √† chacun des pointeurs contenus dans l&rsquo;attribut <code>animals</code>.<br>Ces pointeurs √©tant utilis√©s pour g√©rer le cycle de vie des donn√©es point√©es, il s&rsquo;agit de pointeurs-ownants.<br>On repr√©sente donc les relations associ√©es avec des fl√®ches pleines.
<a href=#R-image-774bc82f437026a7efd34a379398063c class=lightbox-link><img class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../images/chapter3/ownership/07-case-2a.svg style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-774bc82f437026a7efd34a379398063c><img class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../images/chapter3/ownership/07-case-2a.svg></a></p></div></div></div></p></li><li><p>Dessinez maintenant les modifications dans ce graphe une fois arriv√© √† la ligne 14 (c&rsquo;est-√†-dire pendant la sortie du <code>main</code>, lorsque l&rsquo;instance de <code>many_animals</code> est en cours de destruction).<div class=hidden-solution><button class=show-solution-btn onclick='this.classList.add("off"),this.nextElementSibling.classList.remove("off")'>
‚Æü Afficher la solution ‚Æü</button><div class=off><button class=hide-solution-btn onclick='this.parentElement.classList.add("off"),this.parentElement.previousElementSibling.classList.remove("off")'>
‚Æù Masquer la solution ‚Æù</button><div class=hidden-solution-content><p>√Ä la ligne 14, les instances de <code>Animal</code> ont toutes √©t√© lib√©r√©es.<br><a href=#R-image-623cbc1b62226e7a89b55e9f25d9fcd2 class=lightbox-link><img class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../images/chapter3/ownership/07-case-2b.svg style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-623cbc1b62226e7a89b55e9f25d9fcd2><img class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../images/chapter3/ownership/07-case-2b.svg></a></p></div></div></div></p></li><li><p>La ligne 34 est comment√©e, car si elle ne l&rsquo;est pas, le programme se termine avec une erreur.<br>Pour comprendre ce qu&rsquo;il se passe, reprenez le graphe de la question 1, et ajoutez les modifications d√©crivant l&rsquo;√©tat du programme une fois arriv√© dans la fonction <code>display_animals</code> (ligne 20).<br>Quel est le probl√®me dans ce graphe ?<div class=hidden-solution><button class=show-solution-btn onclick='this.classList.add("off"),this.nextElementSibling.classList.remove("off")'>
‚Æü Afficher la solution ‚Æü</button><div class=off><button class=hide-solution-btn onclick='this.parentElement.classList.add("off"),this.parentElement.previousElementSibling.classList.remove("off")'>
‚Æù Masquer la solution ‚Æù</button><div class=hidden-solution-content><p>L&rsquo;argument est pass√© par valeur, on a donc une copie de la variable <code>many_animals</code>.<br>En revanche, lorsqu&rsquo;un pointeur est copi√©, l&rsquo;√©l√©ment point√© ne l&rsquo;est pas.
<a href=#R-image-dc79889d0d4e91a8d728eb3ba9b80448 class=lightbox-link><img class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../images/chapter3/ownership/07-case-2c.svg style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-dc79889d0d4e91a8d728eb3ba9b80448><img class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../images/chapter3/ownership/07-case-2c.svg></a>
Le probl√®me ici, c&rsquo;est qu&rsquo;on a maintenant deux owners pour les donn√©es <code>dog</code>, <code>cat</code> et <code>mouse</code>.</p></div></div></div></p></li><li><p>Dessinez maintenant le graphe √† la sortie de la fonction <code>display_animals</code>.<br>Expliquez ce qui pose probl√®me et qui emp√™che le programme de se terminer correctement.<div class=hidden-solution><button class=show-solution-btn onclick='this.classList.add("off"),this.nextElementSibling.classList.remove("off")'>
‚Æü Afficher la solution ‚Æü</button><div class=off><button class=hide-solution-btn onclick='this.parentElement.classList.add("off"),this.parentElement.previousElementSibling.classList.remove("off")'>
‚Æù Masquer la solution ‚Æù</button><div class=hidden-solution-content><p>√Ä la fin de <code>display_animals</code>, on d√©sinstancie le param√®tre <code>many_animals</code>, ainsi que les donn√©es qu&rsquo;il own r√©cursivement.
<a href=#R-image-cbdef1362d6d9b8be42b9c5e90480c55 class=lightbox-link><img class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../images/chapter3/ownership/07-case-2d.svg style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-cbdef1362d6d9b8be42b9c5e90480c55><img class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../images/chapter3/ownership/07-case-2d.svg></a>
Les pointeurs contenus dans <code>many_animals.animals</code> (la variable du <code>main</code>) pointent donc sur des donn√©es invalid√©es.<br>√Ä la destruction de <code>many_animals</code>, les instructions <code>delete a</code> vont par cons√©quent √©chouer.</p></div></div></div></p></li><li><p>Proposez une solution pour r√©soudre le probl√®me et dessinez le graphe d&rsquo;ownership associ√©.<div class=hidden-solution><button class=show-solution-btn onclick='this.classList.add("off"),this.nextElementSibling.classList.remove("off")'>
‚Æü Afficher la solution ‚Æü</button><div class=off><button class=hide-solution-btn onclick='this.parentElement.classList.add("off"),this.parentElement.previousElementSibling.classList.remove("off")'>
‚Æù Masquer la solution ‚Æù</button><div class=hidden-solution-content><p>Il suffit de changer la signature de <code>display_animals</code> pour passer le param√®tre par r√©f√©rence (qui peut d&rsquo;ailleurs √™tre constante).
Les r√©f√©rences n&rsquo;ayant pas d&rsquo;impact sur le cycle de vie des donn√©es, lorsque l&rsquo;on sort de la fonction, aucun √©l√©ment ne sera d√©sinstanci√©.
<a href=#R-image-0046883669f795ab9869ec2cb680a61e class=lightbox-link><img class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../images/chapter3/ownership/07-case-2e.svg style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-0046883669f795ab9869ec2cb680a61e><img class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../images/chapter3/ownership/07-case-2e.svg></a></p></div></div></div></p></li></ol><hr><h3 id=synth√®se>Synth√®se</h3><ul><li>L&rsquo;√©l√©ment responsable du cycle de vie d&rsquo;une donn√©e est son <strong>owner</strong>.</li><li>Un <strong>pointeur-ownant</strong> doit lib√©rer la donn√©e allou√©e ou bien transmettre cette responsabilit√© √† un autre pointeur.</li><li>Un <strong>pointeur-observant</strong> a le m√™me r√¥le qu&rsquo;une r√©f√©rence, si ce n&rsquo;est qu&rsquo;il peut √™tre vide (= <code>nullptr</code>) et est r√©assignable.</li><li>Un graphe d&rsquo;ownership permet de d√©tecter diff√©rents probl√®mes :<ul><li>Si une donn√©e est own√©e par plusieurs √©l√©ments ‚ûî lib√©ration multiple,</li><li>Si on r√©f√©rence une donn√©e qui n&rsquo;existe plus ‚ûî dangling-reference.</li></ul></li><li>Savoir qui own une donn√©e aide √† savoir s&rsquo;il est valide d&rsquo;y acc√©der ou pas.</li></ul><footer class=footline></footer></article></div></main></div><aside id=R-sidebar class="default-animation showVisitedLinks"><div id=R-header-topbar class=default-animation></div><div id=R-header-wrapper class=default-animation><div id=R-header class=default-animation><a id=logo href=../../>üéÑ C++ üéÑ</a></div></div><div id=R-homelinks class=default-animation><hr class=padding></div><div id=R-content-wrapper class=highlightable><div id=R-topics><ul class="enlarge morespace collapsible-menu"><li data-nav-id=/chapter0/index.html><a class=padding href=../../chapter0/index.html><b>0- </b>Mise en place<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-bb41caf94f12b8a1a4b5e560230e7851 class=collapsible-menu></ul></li><li data-nav-id=/chapter1/index.html><a class=padding href=../../chapter1/index.html><b>1- </b>Introduction au C++<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-6c398714eae4372920aec3a1e6c2e143 class=collapsible-menu></ul></li><li data-nav-id=/chapter2/index.html><a class=padding href=../../chapter2/index.html><b>2- </b>Classes<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-b1df0095a9fd74320697a6d478418ec3 class=collapsible-menu></ul></li><li class=parent data-nav-id=/chapter3/index.html><a class=padding href=../../chapter3/index.html><b>3- </b>Cycle de vie<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-9f6546bce6f8e9a77063b71c880fd5b8 class=collapsible-menu><li data-nav-id=/chapter3/1-allocation/index.html><a class=padding href=../../chapter3/1-allocation/index.html>Allocation dynamique üéá<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-id=/chapter3/2-lifespan/index.html><a class=padding href=../../chapter3/2-lifespan/index.html>Dur√©e de vie ‚è≥<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-id=/chapter3/3-storage/index.html><a class=padding href=../../chapter3/3-storage/index.html>Espace de stockage üíæ<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-id=/chapter3/4-references/index.html><a class=padding href=../../chapter3/4-references/index.html>Usage des r√©f√©rences üîÄ<i class="fa-fw fas fa-check read-icon"></i></a></li><li class=active data-nav-id=/chapter3/5-ownership/index.html><a class=padding href=../../chapter3/5-ownership/index.html>Ownership üèòÔ∏è<i class="fa-fw fas fa-check read-icon"></i></a></li><li data-nav-id=/chapter3/test/index.html><a class=padding href=../../chapter3/test/index.html>Questionnaire ‚òë<i class="fa-fw fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/chapter4/index.html><a class=padding href=../../chapter4/index.html><b>4- </b>H√©ritage<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-48065e8b6e7e69533ca73b3931c8a0a1 class=collapsible-menu></ul></li><li data-nav-id=/chapter5/index.html><a class=padding href=../../chapter5/index.html><b>5- </b>Librairie standard<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-86528e6ba587b53932a1dafaa9cd375c class=collapsible-menu></ul></li><li data-nav-id=/chapter6/index.html><a class=padding href=../../chapter6/index.html><b>6- </b>Algorithmes<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-016ee40825ff7c4aeecbac08a8ca264b class=collapsible-menu></ul></li><li data-nav-id=/chapter9/index.html><a class=padding href=../../chapter9/index.html><b>7- </b>Templates<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-24ddf636ccd0ce3ef39c8060d1779332 class=collapsible-menu></ul></li><li data-nav-id=/chapter10/index.html><a class=padding href=../../chapter10/index.html><b>8- </b>Param√®tres de templates<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-66e6e0c58d73995ecc09e8fbbe358e51 class=collapsible-menu></ul></li></ul></div><div id=R-shortcuts><div class="nav-title padding">Acc√®s rapide</div><ul class=space><li><a class=padding href=https://github.com/Laefy/CPP_Learning_Code/><i class='fab fa-github'></i> D√©p√¥t Cours</a></li><li><a class=padding href=https://github.com/Laefy/CPP_Exercises/><i class='fab fa-github'></i> D√©p√¥t TPs</a></li><li><a class=padding href=../../slides/index.html><i class='far fa-file-powerpoint'></i> Slides</a></li><li><a class=padding href=../../workflow/index.html><i class='far fa-list-alt'></i> Workflow</a></li><li><a class=padding href=../../faq/index.html><i class='fas fa-question-circle'></i> FAQ</a></li><li><a class=padding href=../../chapter0/6-tips/index.html><i class='fa fa-rocket'></i> Astuces</a></li><li><a class=padding href=https://godbolt.org/><i class='fas fa-cog'></i> Compiler Explorer</a></li><li><a class=padding href=https://en.cppreference.com/w/><i class='fas fa-passport'></i> CPP-Ref</a></li></ul></div><div class="padding footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVisitedLinks showFooter"></div><div id=R-menu-footer><hr class="padding default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVisitedLinks showFooter"><div id=R-prefooter class="footerLangSwitch footerVariantSwitch footerVisitedLinks showVisitedLinks"><ul><li id=R-select-language-container class=footerLangSwitch><div class="padding menu-control"><i class="fa-fw fas fa-language"></i>
<span>&nbsp;</span><div class=control-style><label class=a11y-only for=R-select-language>Langue</label>
<select id=R-select-language onchange="location=this.querySelector(this.value).dataset.url"><option id=R-select-language-fr value=#R-select-language-fr data-url=../../chapter3/5-ownership/index.html lang=fr selected>Fran√ßais</option></select></div><div class=clear></div></div></li><li id=R-select-variant-container class=footerVariantSwitch><div class="padding menu-control"><i class="fa-fw fas fa-paint-brush"></i>
<span>&nbsp;</span><div class=control-style><label class=a11y-only for=R-select-variant>Th√®me</label>
<select id=R-select-variant onchange=window.variants&&variants.changeVariant(this.value)><option id=R-select-variant-mine value=mine selected>Mine</option></select></div><div class=clear></div></div><script>window.variants&&variants.markSelectedVariant()</script></li><li class="footerVisitedLinks showVisitedLinks"><div class="padding menu-control"><i class="fa-fw fas fa-history"></i>
<span>&nbsp;</span><div class=control-style><button onclick=clearHistory()>Supprimer l'historique</button></div><div class=clear></div></div></li></ul></div><div id=R-footer class="footerFooter showFooter"><p>Built with <a href=https://github.com/McShelby/hugo-theme-relearn title=love><i class="fas fa-heart"></i></a> by <a href=https://gohugo.io/>Hugo</a></p></div></div></div></aside><script src=../../js/clipboard.min.js?1729268597 defer></script><script src=../../js/perfect-scrollbar.min.js?1729268597 defer></script><script src=../../js/theme.js?1729268597 defer></script><button id=footer-question-btn title="Envoyer un message √† propos du texte s√©lectionn√©" onclick=openQuestionForm() disabled><i class="fas fa-question-circle"></i></button><div id=footer-question-window disabled><form id=question method=POST action=https://formsubmit.co/3aa0f379a1aed9c454634cc2da153a7b target=question-submitted onsubmit=cleanQuestionFormContent()><input type=email name=email placeholder=mon_email@smthg.com required onchange=updateQuestionFormSubject()>
<textarea name=question rows=7 cols=30 placeholder="Mon message..."></textarea>
<input type=hidden name=selection>
<input type=hidden name=_replyto>
<input type=hidden name=_subject>
<input type=hidden name=_template value=box>
<input type=hidden name=_captcha value=false>
<input type=hidden name=_next value=//question-submitted/>
<input type=submit disabled style=display:none aria-hidden=true>
<input type=submit value=Envoyer></form><iframe class=hidden name=question-submitted src></iframe></div><script>function updateQuestionFormSubject(){let e=document.querySelector('#question>input[name="email"]').value;document.querySelector('#question>input[name="_subject"]').value="[C++][Chapitre 3] "+e+", retour sur ta question"}function cleanQuestionFormContent(){function e(e){e.value=e.value.replace(/\[\.\./g,"[ ..")}e(document.querySelector('#question>textarea[name="question"]')),e(document.querySelector('#question>input[name="selection"]'))}function openQuestionForm(){document.getElementById("footer-question-window").removeAttribute("disabled");var e=window.getSelection().toString();document.querySelector('#question>input[name="selection"]').value=e}function updateQuestionWidgetState(e){var t=document.getElementById("R-body-inner"),n=window.getSelection(),s=document.getElementById("footer-question-window");document.getElementById("footer-question-btn").disabled=n.isCollapsed||t==null||t.contains(n.anchorNode)==!1||t.contains(n.focusNode)==!1,e!==void 0&&e.type=="mouseup"&&s.contains(e.target)==!1&&s.contains(document.activeElement)==!1&&s.setAttribute("disabled",!0)}updateQuestionFormSubject(),document.onmouseup=document.onkeyup=document.onselectionchange=updateQuestionWidgetState,updateQuestionWidgetState()</script></body></html>