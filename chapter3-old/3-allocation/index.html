<!doctype html><html lang=fr dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 7.0.1+72a875f1db967152c77914cff4d53f8fcee0e619"><meta name=description content="Nous allons maintenant voir comment il est possible d‚Äôallouer de la m√©moire simplement, en particulier sans avoir √† se soucier des fuites m√©moire.
Allocation d‚Äôune primitive Pour cr√©er un objet sur le tas, nous allons nous servir d‚Äôun petit utilitaire appel√© std::unique_ptr et de la fonction std::make_unique. Ces deux symboles se trouvent dans le header <memory>.
Voici la syntaxe permettant d‚Äôallouer de la m√©moire pour un entier :
#include <iostream> #include <memory> void fcn() { std::unique_ptr<int> int_on_heap = std::make_unique<int>(3); std::cout << *int_on_heap << std::endl; // affiche 3 *int_on_heap = 5; std::cout << *int_on_heap << std::endl; // affiche 5 } La classe unique_ptr est donc un symbole que l‚Äôon template par le type qu‚Äôil doit contenir."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Allocation dynamique :: Cours de C++ - Niveau Master"><meta name=twitter:description content="Nous allons maintenant voir comment il est possible d‚Äôallouer de la m√©moire simplement, en particulier sans avoir √† se soucier des fuites m√©moire.
Allocation d‚Äôune primitive Pour cr√©er un objet sur le tas, nous allons nous servir d‚Äôun petit utilitaire appel√© std::unique_ptr et de la fonction std::make_unique. Ces deux symboles se trouvent dans le header <memory>.
Voici la syntaxe permettant d‚Äôallouer de la m√©moire pour un entier :
#include <iostream> #include <memory> void fcn() { std::unique_ptr<int> int_on_heap = std::make_unique<int>(3); std::cout << *int_on_heap << std::endl; // affiche 3 *int_on_heap = 5; std::cout << *int_on_heap << std::endl; // affiche 5 } La classe unique_ptr est donc un symbole que l‚Äôon template par le type qu‚Äôil doit contenir."><meta property="og:url" content="/chapter3-old/3-allocation/index.html"><meta property="og:site_name" content="Cours de C++ - Niveau Master"><meta property="og:title" content="Allocation dynamique :: Cours de C++ - Niveau Master"><meta property="og:description" content="Nous allons maintenant voir comment il est possible d‚Äôallouer de la m√©moire simplement, en particulier sans avoir √† se soucier des fuites m√©moire.
Allocation d‚Äôune primitive Pour cr√©er un objet sur le tas, nous allons nous servir d‚Äôun petit utilitaire appel√© std::unique_ptr et de la fonction std::make_unique. Ces deux symboles se trouvent dans le header <memory>.
Voici la syntaxe permettant d‚Äôallouer de la m√©moire pour un entier :
#include <iostream> #include <memory> void fcn() { std::unique_ptr<int> int_on_heap = std::make_unique<int>(3); std::cout << *int_on_heap << std::endl; // affiche 3 *int_on_heap = 5; std::cout << *int_on_heap << std::endl; // affiche 5 } La classe unique_ptr est donc un symbole que l‚Äôon template par le type qu‚Äôil doit contenir."><meta property="og:locale" content="fr"><meta property="og:type" content="article"><meta property="article:section" content="Gestion m√©moire"><meta itemprop=name content="Allocation dynamique :: Cours de C++ - Niveau Master"><meta itemprop=description content="Nous allons maintenant voir comment il est possible d‚Äôallouer de la m√©moire simplement, en particulier sans avoir √† se soucier des fuites m√©moire.
Allocation d‚Äôune primitive Pour cr√©er un objet sur le tas, nous allons nous servir d‚Äôun petit utilitaire appel√© std::unique_ptr et de la fonction std::make_unique. Ces deux symboles se trouvent dans le header <memory>.
Voici la syntaxe permettant d‚Äôallouer de la m√©moire pour un entier :
#include <iostream> #include <memory> void fcn() { std::unique_ptr<int> int_on_heap = std::make_unique<int>(3); std::cout << *int_on_heap << std::endl; // affiche 3 *int_on_heap = 5; std::cout << *int_on_heap << std::endl; // affiche 5 } La classe unique_ptr est donc un symbole que l‚Äôon template par le type qu‚Äôil doit contenir."><meta itemprop=wordCount content="1512"><title>Allocation dynamique :: Cours de C++ - Niveau Master</title>
<link href=../../css/fontawesome-all.min.css?1729268597 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../css/fontawesome-all.min.css?1729268597 rel=stylesheet></noscript><link href=../../css/nucleus.css?1729268597 rel=stylesheet><link href=../../css/auto-complete.css?1729268597 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../css/auto-complete.css?1729268597 rel=stylesheet></noscript><link href=../../css/perfect-scrollbar.min.css?1729268597 rel=stylesheet><link href=../../css/fonts.css?1729268597 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../css/fonts.css?1729268597 rel=stylesheet></noscript><link href=../../css/theme.css?1729268597 rel=stylesheet><link href=../../css/theme-mine.css?1729268597 rel=stylesheet id=R-variant-style><link href=../../css/chroma-relearn-light.css?1729268597 rel=stylesheet id=R-variant-chroma-style><link href=../../css/print.css?1729268597 rel=stylesheet media=print><script src=../../js/variant.js?1729268597></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../..",window.relearn.relBaseUri="../..",window.relearn.absBaseUri="",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.variants&&variants.init(["mine"]),window.T_Copy_to_clipboard=`Copier dans le presse-papiers`,window.T_Copied_to_clipboard=`Copi√© dans le presse-papiers!`,window.T_Copy_link_to_clipboard=`Copier le lien dans le presse-papiers`,window.T_Link_copied_to_clipboard=`Lien copi√© dans le presse-papiers!`,window.T_Reset_view=`R√©initialiser la vue`,window.T_View_reset=`Vue r√©initialis√©e!`,window.T_No_results_found=`Aucun r√©sultat trouv√© pour "{0}"`,window.T_N_results_found=`{1} r√©sultats trouv√©s pour "{0}"`</script></head><body class="mobile-support html disableInlineCopyToClipboard" data-url=../../chapter3-old/3-allocation/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table des mati√®res (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><ul><li><a href=#allocation-dune-primitive>Allocation d&rsquo;une primitive</a></li><li><a href=#allocation-dun-objet>Allocation d&rsquo;un objet</a></li><li><a href=#manipulation>Manipulation</a></li><li><a href=#copie>Copie</a></li><li><a href=#un-peu-de-pratique>Un peu de pratique</a></li><li><a href=#r√©allocation-de-vector>R√©allocation de vector</a></li></ul></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../index.html><span itemprop=name>Accueil</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Gestion m√©moire</span><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Allocation dynamique</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=../../chapter3-old/2-ownership/index.html title="Ownership (ü°ê)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=../../chapter3-old/4-move-sem/index.html title="D√©placement (ü°í)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Aller plus loin"><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable chapter3-old" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=allocation-dynamique>Allocation dynamique</h1><p>Nous allons maintenant voir comment il est possible d&rsquo;allouer de la m√©moire simplement, en particulier sans avoir √† se soucier des fuites m√©moire.</p><hr><h3 id=allocation-dune-primitive>Allocation d&rsquo;une primitive</h3><p>Pour cr√©er un objet sur le tas, nous allons nous servir d&rsquo;un petit utilitaire appel√© <code>std::unique_ptr</code> et de la fonction <code>std::make_unique</code>.
Ces deux symboles se trouvent dans le header <code>&lt;memory></code>.</p><p>Voici la syntaxe permettant d&rsquo;allouer de la m√©moire pour un entier :</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;memory&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>fcn</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=n>int_on_heap</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=o>*</span><span class=n>int_on_heap</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>                         <span class=c1>// affiche 3
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>int_on_heap</span> <span class=o>=</span> <span class=mi>5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=o>*</span><span class=n>int_on_heap</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>                         <span class=c1>// affiche 5
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span></span></span></code></pre></div><p>La classe <code>unique_ptr</code> est donc un symbole que l&rsquo;on template par le type qu&rsquo;il doit contenir.<br>La fonction <code>make_unique</code> prend la valeur avec laquelle on souhaite initialiser l&rsquo;objet.<br>On acc√®de ensuite au contenu avec l&rsquo;op√©rateur <code>*</code>, un peu comme pour un pointeur en C.</p><p>La magie ici, c&rsquo;est qu&rsquo;une fois que l&rsquo;on sort de la fonction, le destructeur de la classe <code>unique_ptr</code> s&rsquo;occupe tout seul de d√©sallouer la m√©moire.
Vous n&rsquo;avez donc pas √† vous soucier de faire des <code>free</code> ou des <code>delete</code>, tout est lib√©r√© automatiquement.</p><hr><h3 id=allocation-dun-objet>Allocation d&rsquo;un objet</h3><p>Voyons maintenant comment cela se passe avec une classe.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;memory&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Dog</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>friend</span> <span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=k>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>&amp;</span> <span class=n>stream</span><span class=p>,</span> <span class=k>const</span> <span class=n>Dog</span><span class=o>&amp;</span> <span class=n>dog</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>stream</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;I have a &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>dog</span><span class=p>.</span><span class=n>breed</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; named &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>dog</span><span class=p>.</span><span class=n>name</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;.&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Dog</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span> <span class=n>name</span><span class=p>,</span> <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span> <span class=n>breed</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>:</span> <span class=n>_name</span> <span class=p>{</span> <span class=n>name</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>,</span> <span class=n>_breed</span> <span class=p>{</span> <span class=n>breed</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>rename</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span> <span class=n>new_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>_name</span> <span class=o>=</span> <span class=n>new_name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>bool</span> <span class=k>operator</span><span class=o>==</span><span class=p>(</span><span class=k>const</span> <span class=n>Dog</span><span class=o>&amp;</span> <span class=n>other</span><span class=p>)</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=n>_name</span> <span class=o>==</span> <span class=n>other</span><span class=p>.</span><span class=n>_name</span> <span class=o>&amp;&amp;</span> <span class=n>_breed</span> <span class=o>==</span> <span class=n>other</span><span class=p>.</span><span class=n>_breed</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>_name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>_breed</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span> <span class=n>dog</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span><span class=p>(</span><span class=s>&#34;Lassie&#34;</span><span class=p>,</span> <span class=s>&#34;Colley&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=o>*</span><span class=n>dog</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>dog</span><span class=o>-&gt;</span><span class=n>rename</span><span class=p>(</span><span class=s>&#34;Doggie&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=o>*</span><span class=n>dog</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>C&rsquo;est quasiment pareil que pour la primitive, la subtilit√© √©tant que l&rsquo;on peut directement passer au <code>make_unique</code> les param√®tres que l&rsquo;on passerait au constructeur de la classe.<br>On peut donc √©crire directement <code>std::make_unique&lt;Dog>("Lassie", "Colley")</code> √† la place de <code>std::make_unique&lt;Dog>(Dog { "Lassie", "Colley" })</code>.</p><p>En ce qui concerne l&rsquo;acc√®s aux fonctions-membres et aux attributs, cela se fait avec l&rsquo;op√©rateur <code>-></code>.</p><hr><h3 id=manipulation>Manipulation</h3><p>Nous allons maintenant voir ce que l&rsquo;on peut faire avec un <code>unique_ptr</code>.</p><h5 id=initialisation>Initialisation</h5><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span> <span class=n>dog</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span><span class=p>(</span><span class=s>&#34;Lassie&#34;</span><span class=p>,</span> <span class=s>&#34;Colley&#34;</span><span class=p>);</span></span></span></code></pre></div><h5 id=r√©assignation>R√©assignation</h5><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span> <span class=n>dog</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span><span class=p>(</span><span class=s>&#34;Lassie&#34;</span><span class=p>,</span> <span class=s>&#34;Colley&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>dog</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span><span class=p>(</span><span class=s>&#34;Snoopy&#34;</span><span class=p>,</span> <span class=s>&#34;Beagle&#34;</span><span class=p>);</span></span></span></code></pre></div><h5 id=suppression>Suppression</h5><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span> <span class=n>dog</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span><span class=p>(</span><span class=s>&#34;Lassie&#34;</span><span class=p>,</span> <span class=s>&#34;Colley&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>dog</span><span class=p>.</span><span class=n>reset</span><span class=p>();</span></span></span></code></pre></div><h5 id=acc√®s>Acc√®s</h5><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span> <span class=n>dog</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span><span class=p>(</span><span class=s>&#34;Snoopy&#34;</span><span class=p>,</span> <span class=s>&#34;Beagle&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>dog</span><span class=o>-&gt;</span><span class=n>rename</span><span class=p>(</span><span class=s>&#34;Chnoupy&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=o>*</span><span class=n>dog</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span></span></span></code></pre></div><h5 id=test>Test</h5><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span> <span class=n>dog</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>dog</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=o>*</span><span class=n>dog</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;No dogs yet!&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><h5 id=comparaison>Comparaison</h5><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span> <span class=n>dog1</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span><span class=p>(</span><span class=s>&#34;Lassie&#34;</span><span class=p>,</span> <span class=s>&#34;Colley&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span> <span class=n>dog2</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span><span class=p>(</span><span class=s>&#34;Lassie&#34;</span><span class=p>,</span> <span class=s>&#34;Colley&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>dog1</span> <span class=o>!=</span> <span class=k>nullptr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>dog1</span> <span class=o>!=</span> <span class=n>dog2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>*</span><span class=n>dog1</span> <span class=o>==</span> <span class=o>*</span><span class=n>dog2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;We have two different dogs, but they have the same names and breed.&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><div class="box notices cstyle warning"><div class=box-label><i class="fa-fw fas fa-exclamation-triangle"></i> Avertissement</div><div class=box-content><p>En C++, le pointeur null se nomme <code>nullptr</code>. Ce n&rsquo;est donc pas comme en C, o√π on utilise <code>NULL</code>.</p></div></div><hr><h3 id=copie>Copie</h3><p>La classe <code>unique_ptr</code> ne se nomme pas <code>unique_ptr</code> pas hasard.
Il est en effet interdit de faire des copies de <code>unique_ptr</code>.</p><p>Le compilateur vous emp√™chera par exemple de compiler le code suivant :</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span> <span class=n>dog</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span><span class=p>(</span><span class=s>&#34;Lassie&#34;</span><span class=p>,</span> <span class=s>&#34;Colley&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span> <span class=n>dog_copy</span> <span class=o>=</span> <span class=n>dog</span><span class=p>;</span> <span class=c1>// Ouch!
</span></span></span></code></pre></div><p><strong>Quel est l&rsquo;int√©r√™t d&rsquo;emp√™cher la copie d&rsquo;un unique_ptr ?</strong></p><p>Cela permet de clarifier l&rsquo;ownership de l&rsquo;objet allou√© en interne.</p><p>En effet, si le code pr√©c√©dent √©tait valide, qui selon vous de <code>dog</code> ou de <code>dog_copy</code> serait le propri√©taire de Lassie (c&rsquo;est-√†-dire l&rsquo;objet allou√© en m√©moire) ?<br>A la destruction de <code>dog</code>, est-ce qu&rsquo;il faudrait d√©truire Lassie et lib√©rer la m√©moire ? Que se passe-t-il du coup si <code>dog_copy</code> n&rsquo;est pas encore d√©truit et que l&rsquo;on appelle <code>rename</code> dessus ?<br>Toutes ses questions font qu&rsquo;on risquerait de se retrouver avec des r√©f√©rences sur des objets non valides.</p><p>Pour simplifier, le <code>unique_ptr</code> ne g√®re que de l&rsquo;ownership unique et √† sa destruction, il supprime bien l&rsquo;objet allou√© de la m√©moire afin de garantir l&rsquo;absence de <strong>memory leaks</strong>.</p><p><strong>Ok, mais si en fait, ce que je voulais, c&rsquo;√©tait une copie du premier objet, qui aurait sa propre dur√©e de vie ?</strong></p><p>Dans ce cas, vous pouvez r√©utiliser <code>make_unique</code>, en faisant appel au constructeur de copie de l&rsquo;objet :</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span> <span class=n>dog</span>      <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span><span class=p>(</span><span class=s>&#34;Lassie&#34;</span><span class=p>,</span> <span class=s>&#34;Colley&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span> <span class=n>dog_copy</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span><span class=p>(</span><span class=o>*</span><span class=n>dog</span><span class=p>);</span></span></span></code></pre></div><p>Notez bien qu&rsquo;ici, les deux pointeurs pointent sur deux objets diff√©rents en m√©moire.<br>Si on appelle <code>rename</code> sur <code>dog_copy</code>, le nom de <code>dog</code> ne sera pas modifi√©.</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span> <span class=n>dog</span>      <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span><span class=p>(</span><span class=s>&#34;Lassie&#34;</span><span class=p>,</span> <span class=s>&#34;Colley&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span> <span class=n>dog_copy</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Dog</span><span class=o>&gt;</span><span class=p>(</span><span class=o>*</span><span class=n>dog</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>dog_copy</span><span class=o>-&gt;</span><span class=n>rename</span><span class=p>(</span><span class=s>&#34;Chouchou&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=o>*</span><span class=n>dog</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>      <span class=c1>// -&gt; Lassie 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=o>*</span><span class=n>dog_copy</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span> <span class=c1>// -&gt; Chouchou 
</span></span></span></code></pre></div><hr><h3 id=un-peu-de-pratique>Un peu de pratique</h3><p>Pour vous habituez √† manipuler les <code>unique_ptr</code>, vous allez modifier le code du programme <code>c3-3-cat</code>.</p><p>Commencez par allouer dynamiquement un objet de type <code>Cat</code> et affichez son contenu √† l&rsquo;aide de l&rsquo;op√©rateur <code>&lt;&lt;</code> d√©j√† d√©fini.<div class=expand><input type=checkbox id=R-expand-22b4dd7303c0064eb2629df18771a053 aria-controls=R-expandcontent-22b4dd7303c0064eb2629df18771a053>
<label class=expand-label for=R-expand-22b4dd7303c0064eb2629df18771a053><i class="expander-icon fa-fw fas fa-chevron-down"></i>
<i class="expander-icon fa-fw fas fa-chevron-right"></i> Solution</label><div id=R-expandcontent-22b4dd7303c0064eb2629df18771a053 class=expand-content><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;Cat.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;memory&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Cat</span><span class=o>&gt;</span> <span class=n>cat</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Cat</span><span class=o>&gt;</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=o>*</span><span class=n>cat</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></p><p>Red√©finissez le destructeur de <code>Cat</code> pour afficher du texte et v√©rifier que l&rsquo;objet point√© est bien d√©truit √† la sortie du scope, lorsque le <code>unique_ptr</code> est d√©truit.<div class=expand><input type=checkbox id=R-expand-0385e2a92b93fd0230e409796f3d7ffa aria-controls=R-expandcontent-0385e2a92b93fd0230e409796f3d7ffa>
<label class=expand-label for=R-expand-0385e2a92b93fd0230e409796f3d7ffa><i class="expander-icon fa-fw fas fa-chevron-down"></i>
<i class="expander-icon fa-fw fas fa-chevron-right"></i> Solution</label><div id=R-expandcontent-0385e2a92b93fd0230e409796f3d7ffa class=expand-content><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=o>~</span><span class=n>Cat</span><span class=p>()</span> <span class=p>{</span> <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Cat &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>_name</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; has died...&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span> <span class=p>}</span></span></span></code></pre></div></div></div></p><p>Ajoutez un constructeur √† 1 param√®tre √† la classe <code>Cat</code> pour initialiser son attribut <code>_name</code>.<br>Adaptez l&rsquo;initialisation du <code>unique_ptr</code> afin que le programme puisse compiler.<div class=expand><input type=checkbox id=R-expand-90b10f167af9644a6332df2e1be2e48f aria-controls=R-expandcontent-90b10f167af9644a6332df2e1be2e48f>
<label class=expand-label for=R-expand-90b10f167af9644a6332df2e1be2e48f><i class="expander-icon fa-fw fas fa-chevron-down"></i>
<i class="expander-icon fa-fw fas fa-chevron-right"></i> Solution</label><div id=R-expandcontent-90b10f167af9644a6332df2e1be2e48f class=expand-content><p><code>Cat.h</code> :</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Cat</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Cat</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span> <span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>:</span> <span class=n>_name</span> <span class=p>{</span> <span class=n>name</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// ..
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>_name</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></div><p><code>Cat.cpp</code> :</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Cat</span><span class=o>&gt;</span> <span class=n>cat</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Cat</span><span class=o>&gt;</span><span class=p>(</span><span class=s>&#34;Felix&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=o>*</span><span class=n>cat</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></p><p>Cr√©ez maintenant un <code>unique_ptr&lt;Cat></code> vide et v√©rifiez que celui-ci est bien √©gal √† <code>nullptr</code>.<div class=expand><input type=checkbox id=R-expand-0c3eb018d8185351a0b9691af03ff34a aria-controls=R-expandcontent-0c3eb018d8185351a0b9691af03ff34a>
<label class=expand-label for=R-expand-0c3eb018d8185351a0b9691af03ff34a><i class="expander-icon fa-fw fas fa-chevron-down"></i>
<i class="expander-icon fa-fw fas fa-chevron-right"></i> Solution</label><div id=R-expandcontent-0c3eb018d8185351a0b9691af03ff34a class=expand-content><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Cat</span><span class=o>&gt;</span> <span class=n>cat1</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Cat</span><span class=o>&gt;</span><span class=p>(</span><span class=s>&#34;Felix&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=o>*</span><span class=n>cat1</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Cat</span><span class=o>&gt;</span> <span class=n>cat2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>cat2</span> <span class=o>==</span> <span class=k>nullptr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;cat2 is nullptr.&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></p><p>R√©assignez ce dernier √† une nouvelle instance de <code>Cat</code> allou√©e dynamiquement.<div class=expand><input type=checkbox id=R-expand-0c1c855111d2510fabc5a66afd14320d aria-controls=R-expandcontent-0c1c855111d2510fabc5a66afd14320d>
<label class=expand-label for=R-expand-0c1c855111d2510fabc5a66afd14320d><i class="expander-icon fa-fw fas fa-chevron-down"></i>
<i class="expander-icon fa-fw fas fa-chevron-right"></i> Solution</label><div id=R-expandcontent-0c1c855111d2510fabc5a66afd14320d class=expand-content><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Cat</span><span class=o>&gt;</span> <span class=n>cat1</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Cat</span><span class=o>&gt;</span><span class=p>(</span><span class=s>&#34;Felix&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=o>*</span><span class=n>cat1</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Cat</span><span class=o>&gt;</span> <span class=n>cat2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>cat2</span> <span class=o>==</span> <span class=k>nullptr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;cat2 is nullptr.&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>cat2</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Cat</span><span class=o>&gt;</span><span class=p>(</span><span class=s>&#34;Dartagnan&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></p><p>Affichez si les deux <code>unique_ptr</code> sont √©gaux, puis si les deux objets point√©s sont √©gaux.<div class=expand><input type=checkbox id=R-expand-46fd76b7a2836c0d5cab73a320971928 aria-controls=R-expandcontent-46fd76b7a2836c0d5cab73a320971928>
<label class=expand-label for=R-expand-46fd76b7a2836c0d5cab73a320971928><i class="expander-icon fa-fw fas fa-chevron-down"></i>
<i class="expander-icon fa-fw fas fa-chevron-right"></i> Solution</label><div id=R-expandcontent-46fd76b7a2836c0d5cab73a320971928 class=expand-content><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Cat</span><span class=o>&gt;</span> <span class=n>cat1</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Cat</span><span class=o>&gt;</span><span class=p>(</span><span class=s>&#34;Felix&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=o>*</span><span class=n>cat1</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Cat</span><span class=o>&gt;</span> <span class=n>cat2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>cat2</span> <span class=o>==</span> <span class=k>nullptr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;cat2 is nullptr.&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>cat2</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Cat</span><span class=o>&gt;</span><span class=p>(</span><span class=s>&#34;Dartagnan&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;cat1 == cat2 ? &#34;</span> <span class=o>&lt;&lt;</span> <span class=p>(</span><span class=n>cat1</span> <span class=o>==</span> <span class=n>cat2</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;*cat1 == *cat2 ? &#34;</span> <span class=o>&lt;&lt;</span> <span class=p>(</span><span class=o>*</span><span class=n>cat1</span> <span class=o>==</span> <span class=o>*</span><span class=n>cat2</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></p><p>R√©initialisez le premier <code>unique_ptr</code> afin que celui-ci d√©truise l&rsquo;objet sur lequel il pointe.<br>V√©rifiez que celui-ci est maintenant bien √©gal √† <code>nullptr</code>.<div class=expand><input type=checkbox id=R-expand-59acf5c995272d9f0395ad99606a7c95 aria-controls=R-expandcontent-59acf5c995272d9f0395ad99606a7c95>
<label class=expand-label for=R-expand-59acf5c995272d9f0395ad99606a7c95><i class="expander-icon fa-fw fas fa-chevron-down"></i>
<i class="expander-icon fa-fw fas fa-chevron-right"></i> Solution</label><div id=R-expandcontent-59acf5c995272d9f0395ad99606a7c95 class=expand-content><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Cat</span><span class=o>&gt;</span> <span class=n>cat1</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Cat</span><span class=o>&gt;</span><span class=p>(</span><span class=s>&#34;Felix&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=o>*</span><span class=n>cat1</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Cat</span><span class=o>&gt;</span> <span class=n>cat2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>cat2</span> <span class=o>==</span> <span class=k>nullptr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;cat2 is nullptr.&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>cat2</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Cat</span><span class=o>&gt;</span><span class=p>(</span><span class=s>&#34;Dartagnan&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;cat1 == cat2 ? &#34;</span> <span class=o>&lt;&lt;</span> <span class=p>(</span><span class=n>cat1</span> <span class=o>==</span> <span class=n>cat2</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;*cat1 == *cat2 ? &#34;</span> <span class=o>&lt;&lt;</span> <span class=p>(</span><span class=o>*</span><span class=n>cat1</span> <span class=o>==</span> <span class=o>*</span><span class=n>cat2</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>cat1</span><span class=p>.</span><span class=n>reset</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>cat1</span> <span class=o>==</span> <span class=k>nullptr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;cat1 is nullptr.&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div></p><hr><h3 id=r√©allocation-de-vector>R√©allocation de vector</h3><p>Revenons √† notre probl√®me de r√©allocations intempestives.</p><p>Voici le code du programme <code>c3-3-bag</code> :</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;vector&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Content</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Content</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>:</span> <span class=n>name</span> <span class=p>{</span> <span class=n>name</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Bag</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Content</span><span class=o>&amp;</span> <span class=n>add</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span> <span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>_contents</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>Content</span><span class=o>&gt;</span> <span class=n>_contents</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Bag</span> <span class=n>bag</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>Content</span><span class=o>&amp;</span> <span class=n>my_thing</span> <span class=o>=</span> <span class=n>bag</span><span class=p>.</span><span class=n>add</span><span class=p>(</span><span class=s>&#34;my_thing&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>200</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>bag</span><span class=p>.</span><span class=n>add</span><span class=p>(</span><span class=s>&#34;another_thing&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>my_thing</span><span class=p>.</span><span class=n>name</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>    <span class=c1>// my_thing ?
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>my_thing</span><span class=p>.</span><span class=n>name</span> <span class=o>=</span> <span class=s>&#34;still_my_thing&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>my_thing</span><span class=p>.</span><span class=n>name</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>    <span class=c1>// still_my_thing ?
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Ce que l&rsquo;on voudrait ici, c&rsquo;est pouvoir garantir que <code>my_thing</code> reste valide jusqu&rsquo;√† la fin du programme, malgr√© les r√©allocations pouvant avoir lieu dans la boucle √† l&rsquo;int√©rieur du <code>main</code>.</p><p>En utilisant des <code>unique_ptr</code> √† l&rsquo;int√©rieur de <code>Bag::_contents</code>, on peut r√©soudre le probl√®me.<br>Testez le code suivant et v√©rifiez qu&rsquo;il fonctionne correctement :</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;memory&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;vector&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Content</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Content</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span> <span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>:</span> <span class=n>name</span> <span class=p>{</span> <span class=n>name</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Bag</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Content</span><span class=o>&amp;</span> <span class=n>add</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span> <span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Content</span><span class=o>&gt;&amp;</span> <span class=n>content</span> <span class=o>=</span> <span class=n>_contents</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>make_unique</span><span class=o>&lt;</span><span class=n>Content</span><span class=o>&gt;</span><span class=p>(</span><span class=n>name</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>*</span><span class=n>content</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>Content</span><span class=o>&gt;&gt;</span> <span class=n>_contents</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Bag</span> <span class=n>bag</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>Content</span><span class=o>&amp;</span> <span class=n>my_thing</span> <span class=o>=</span> <span class=n>bag</span><span class=p>.</span><span class=n>add</span><span class=p>(</span><span class=s>&#34;my_thing&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>200</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>bag</span><span class=p>.</span><span class=n>add</span><span class=p>(</span><span class=s>&#34;another_thing&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>my_thing</span><span class=p>.</span><span class=n>name</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>my_thing</span><span class=p>.</span><span class=n>name</span> <span class=o>=</span> <span class=s>&#34;still_my_thing&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>my_thing</span><span class=p>.</span><span class=n>name</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div><p>Le programme fonctionne comme attendu car nous avons introduit un niveau interm√©diaire entre la m√©moire du <code>vector</code> √† la m√©moire des objets de type <code>Content</code>.</p><p>Avant, pendant la r√©allocation, chacun des objets <code>Content</code> √©tait d√©plac√© vers une nouvelle zone de la m√©moire, d&rsquo;o√π l&rsquo;invalidation des r√©f√©rences.
<a href=#R-image-eff0e45b03c93586c1e37cce1335e62f class=lightbox-link><img class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../images/chapter3/bag-realloc-content.svg style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-eff0e45b03c93586c1e37cce1335e62f><img class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../images/chapter3/bag-realloc-content.svg></a></p><p>D√©sormais, ce sont les <code>unique_ptr</code> qui sont d√©plac√©s ailleurs.
Les √©l√©ments de type <code>Content</code> restent √† leur place.<br>La r√©f√©rence <code>my_thing</code> qui pointe sur l&rsquo;un d&rsquo;entre eux reste donc valide aussi longtemps que <code>bag</code> l&rsquo;est aussi.
<a href=#R-image-ca0cc27aeb49e30f3f62e3c438c2b816 class=lightbox-link><img class="noborder lazy lightbox noshadow figure-image" loading=lazy src=../../images/chapter3/bag-realloc-ptr.svg style=height:auto;width:auto></a>
<a href=javascript:history.back(); class=lightbox-back id=R-image-ca0cc27aeb49e30f3f62e3c438c2b816><img class="noborder lazy lightbox noshadow lightbox-image" loading=lazy src=../../images/chapter3/bag-realloc-ptr.svg></a></p><footer class=footline></footer></article></div></main></div><aside id=R-sidebar class="default-animation showVisitedLinks"><div id=R-header-topbar class=default-animation></div><div id=R-header-wrapper class=default-animation><div id=R-header class=default-animation><a id=logo href=../../>üéÑ C++ üéÑ</a></div></div><div id=R-homelinks class=default-animation><hr class=padding></div><div id=R-content-wrapper class=highlightable><div id=R-topics><ul class="enlarge morespace collapsible-menu"><li data-nav-id=/chapter0/index.html><a class=padding href=../../chapter0/index.html><b>0- </b>Mise en place<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-bb41caf94f12b8a1a4b5e560230e7851 class=collapsible-menu></ul></li><li data-nav-id=/chapter1/index.html><a class=padding href=../../chapter1/index.html><b>1- </b>Introduction au C++<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-6c398714eae4372920aec3a1e6c2e143 class=collapsible-menu></ul></li><li data-nav-id=/chapter2/index.html><a class=padding href=../../chapter2/index.html><b>2- </b>Classes<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-b1df0095a9fd74320697a6d478418ec3 class=collapsible-menu></ul></li><li data-nav-id=/chapter3/index.html><a class=padding href=../../chapter3/index.html><b>3- </b>Cycle de vie<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-9f6546bce6f8e9a77063b71c880fd5b8 class=collapsible-menu></ul></li><li data-nav-id=/chapter4/index.html><a class=padding href=../../chapter4/index.html><b>4- </b>H√©ritage<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-48065e8b6e7e69533ca73b3931c8a0a1 class=collapsible-menu></ul></li><li data-nav-id=/chapter5/index.html><a class=padding href=../../chapter5/index.html><b>5- </b>Librairie standard<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-86528e6ba587b53932a1dafaa9cd375c class=collapsible-menu></ul></li><li data-nav-id=/chapter6/index.html><a class=padding href=../../chapter6/index.html><b>6- </b>Algorithmes<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-016ee40825ff7c4aeecbac08a8ca264b class=collapsible-menu></ul></li><li data-nav-id=/chapter9/index.html><a class=padding href=../../chapter9/index.html><b>7- </b>Templates<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-24ddf636ccd0ce3ef39c8060d1779332 class=collapsible-menu></ul></li><li data-nav-id=/chapter10/index.html><a class=padding href=../../chapter10/index.html><b>8- </b>Param√®tres de templates<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-66e6e0c58d73995ecc09e8fbbe358e51 class=collapsible-menu></ul></li></ul></div><div id=R-shortcuts><div class="nav-title padding">Acc√®s rapide</div><ul class=space><li><a class=padding href=https://github.com/Laefy/CPP_Learning_Code/><i class='fab fa-github'></i> D√©p√¥t Cours</a></li><li><a class=padding href=https://github.com/Laefy/CPP_Exercises/><i class='fab fa-github'></i> D√©p√¥t TPs</a></li><li><a class=padding href=../../slides/index.html><i class='far fa-file-powerpoint'></i> Slides</a></li><li><a class=padding href=../../workflow/index.html><i class='far fa-list-alt'></i> Workflow</a></li><li><a class=padding href=../../faq/index.html><i class='fas fa-question-circle'></i> FAQ</a></li><li><a class=padding href=../../chapter0/6-tips/index.html><i class='fa fa-rocket'></i> Astuces</a></li><li><a class=padding href=https://godbolt.org/><i class='fas fa-cog'></i> Compiler Explorer</a></li><li><a class=padding href=https://en.cppreference.com/w/><i class='fas fa-passport'></i> CPP-Ref</a></li></ul></div><div class="padding footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVisitedLinks showFooter"></div><div id=R-menu-footer><hr class="padding default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVisitedLinks showFooter"><div id=R-prefooter class="footerLangSwitch footerVariantSwitch footerVisitedLinks showVisitedLinks"><ul><li id=R-select-language-container class=footerLangSwitch><div class="padding menu-control"><i class="fa-fw fas fa-language"></i>
<span>&nbsp;</span><div class=control-style><label class=a11y-only for=R-select-language>Langue</label>
<select id=R-select-language onchange="location=this.querySelector(this.value).dataset.url"><option id=R-select-language-fr value=#R-select-language-fr data-url=../../chapter3-old/3-allocation/index.html lang=fr selected>Fran√ßais</option></select></div><div class=clear></div></div></li><li id=R-select-variant-container class=footerVariantSwitch><div class="padding menu-control"><i class="fa-fw fas fa-paint-brush"></i>
<span>&nbsp;</span><div class=control-style><label class=a11y-only for=R-select-variant>Th√®me</label>
<select id=R-select-variant onchange=window.variants&&variants.changeVariant(this.value)><option id=R-select-variant-mine value=mine selected>Mine</option></select></div><div class=clear></div></div><script>window.variants&&variants.markSelectedVariant()</script></li><li class="footerVisitedLinks showVisitedLinks"><div class="padding menu-control"><i class="fa-fw fas fa-history"></i>
<span>&nbsp;</span><div class=control-style><button onclick=clearHistory()>Supprimer l'historique</button></div><div class=clear></div></div></li></ul></div><div id=R-footer class="footerFooter showFooter"><p>Built with <a href=https://github.com/McShelby/hugo-theme-relearn title=love><i class="fas fa-heart"></i></a> by <a href=https://gohugo.io/>Hugo</a></p></div></div></div></aside><script src=../../js/clipboard.min.js?1729268597 defer></script><script src=../../js/perfect-scrollbar.min.js?1729268597 defer></script><script src=../../js/theme.js?1729268597 defer></script><button id=footer-question-btn title="Envoyer un message √† propos du texte s√©lectionn√©" onclick=openQuestionForm() disabled><i class="fas fa-question-circle"></i></button><div id=footer-question-window disabled><form id=question method=POST action=https://formsubmit.co/3aa0f379a1aed9c454634cc2da153a7b target=question-submitted onsubmit=cleanQuestionFormContent()><input type=email name=email placeholder=mon_email@smthg.com required onchange=updateQuestionFormSubject()>
<textarea name=question rows=7 cols=30 placeholder="Mon message..."></textarea>
<input type=hidden name=selection>
<input type=hidden name=_replyto>
<input type=hidden name=_subject>
<input type=hidden name=_template value=box>
<input type=hidden name=_captcha value=false>
<input type=hidden name=_next value=//question-submitted/>
<input type=submit disabled style=display:none aria-hidden=true>
<input type=submit value=Envoyer></form><iframe class=hidden name=question-submitted src></iframe></div><script>function updateQuestionFormSubject(){let e=document.querySelector('#question>input[name="email"]').value;document.querySelector('#question>input[name="_subject"]').value="[C++][Chapitre 3] "+e+", retour sur ta question"}function cleanQuestionFormContent(){function e(e){e.value=e.value.replace(/\[\.\./g,"[ ..")}e(document.querySelector('#question>textarea[name="question"]')),e(document.querySelector('#question>input[name="selection"]'))}function openQuestionForm(){document.getElementById("footer-question-window").removeAttribute("disabled");var e=window.getSelection().toString();document.querySelector('#question>input[name="selection"]').value=e}function updateQuestionWidgetState(e){var t=document.getElementById("R-body-inner"),n=window.getSelection(),s=document.getElementById("footer-question-window");document.getElementById("footer-question-btn").disabled=n.isCollapsed||t==null||t.contains(n.anchorNode)==!1||t.contains(n.focusNode)==!1,e!==void 0&&e.type=="mouseup"&&s.contains(e.target)==!1&&s.contains(document.activeElement)==!1&&s.setAttribute("disabled",!0)}updateQuestionFormSubject(),document.onmouseup=document.onkeyup=document.onselectionchange=updateQuestionWidgetState,updateQuestionWidgetState()</script></body></html>