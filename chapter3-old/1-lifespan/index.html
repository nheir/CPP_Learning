<!doctype html><html lang=fr dir=ltr itemscope itemtype=http://schema.org/Article><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.128.0"><meta name=generator content="Relearn 7.0.1+72a875f1db967152c77914cff4d53f8fcee0e619"><meta name=description content="Port√©e d‚Äôune variable locale Afin de parler de dur√©e de vie, nous allons commencer par parler de la port√©e de nos variables. Comme vous le savez peut-√™tre, la port√©e d‚Äôune variable d√©finit la portion de code dans laquelle le compilateur nous permet de l‚Äôutiliser.
Si on d√©finit une variable dans une fonction, la port√©e de celle-ci d√©marre √† sa d√©finition et se termine √† la fin du bloc dans lequel celle-ci a √©t√© d√©finie."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Dur√©e de vie :: Cours de C++ - Niveau Master"><meta name=twitter:description content="Port√©e d‚Äôune variable locale Afin de parler de dur√©e de vie, nous allons commencer par parler de la port√©e de nos variables. Comme vous le savez peut-√™tre, la port√©e d‚Äôune variable d√©finit la portion de code dans laquelle le compilateur nous permet de l‚Äôutiliser.
Si on d√©finit une variable dans une fonction, la port√©e de celle-ci d√©marre √† sa d√©finition et se termine √† la fin du bloc dans lequel celle-ci a √©t√© d√©finie."><meta property="og:url" content="/chapter3-old/1-lifespan/index.html"><meta property="og:site_name" content="Cours de C++ - Niveau Master"><meta property="og:title" content="Dur√©e de vie :: Cours de C++ - Niveau Master"><meta property="og:description" content="Port√©e d‚Äôune variable locale Afin de parler de dur√©e de vie, nous allons commencer par parler de la port√©e de nos variables. Comme vous le savez peut-√™tre, la port√©e d‚Äôune variable d√©finit la portion de code dans laquelle le compilateur nous permet de l‚Äôutiliser.
Si on d√©finit une variable dans une fonction, la port√©e de celle-ci d√©marre √† sa d√©finition et se termine √† la fin du bloc dans lequel celle-ci a √©t√© d√©finie."><meta property="og:locale" content="fr"><meta property="og:type" content="article"><meta property="article:section" content="Gestion m√©moire"><meta itemprop=name content="Dur√©e de vie :: Cours de C++ - Niveau Master"><meta itemprop=description content="Port√©e d‚Äôune variable locale Afin de parler de dur√©e de vie, nous allons commencer par parler de la port√©e de nos variables. Comme vous le savez peut-√™tre, la port√©e d‚Äôune variable d√©finit la portion de code dans laquelle le compilateur nous permet de l‚Äôutiliser.
Si on d√©finit une variable dans une fonction, la port√©e de celle-ci d√©marre √† sa d√©finition et se termine √† la fin du bloc dans lequel celle-ci a √©t√© d√©finie."><meta itemprop=wordCount content="1465"><title>Dur√©e de vie :: Cours de C++ - Niveau Master</title>
<link href=../../css/fontawesome-all.min.css?1729268528 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../css/fontawesome-all.min.css?1729268528 rel=stylesheet></noscript><link href=../../css/nucleus.css?1729268528 rel=stylesheet><link href=../../css/auto-complete.css?1729268528 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../css/auto-complete.css?1729268528 rel=stylesheet></noscript><link href=../../css/perfect-scrollbar.min.css?1729268528 rel=stylesheet><link href=../../css/fonts.css?1729268528 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=../../css/fonts.css?1729268528 rel=stylesheet></noscript><link href=../../css/theme.css?1729268528 rel=stylesheet><link href=../../css/theme-mine.css?1729268528 rel=stylesheet id=R-variant-style><link href=../../css/chroma-relearn-light.css?1729268528 rel=stylesheet id=R-variant-chroma-style><link href=../../css/print.css?1729268528 rel=stylesheet media=print><script src=../../js/variant.js?1729268528></script><script>window.relearn=window.relearn||{},window.relearn.relBasePath="../..",window.relearn.relBaseUri="../..",window.relearn.absBaseUri="",window.relearn.disableAnchorCopy=!1,window.relearn.disableAnchorScrolling=!1,window.variants&&variants.init(["mine"]),window.T_Copy_to_clipboard=`Copier dans le presse-papiers`,window.T_Copied_to_clipboard=`Copi√© dans le presse-papiers!`,window.T_Copy_link_to_clipboard=`Copier le lien dans le presse-papiers`,window.T_Link_copied_to_clipboard=`Lien copi√© dans le presse-papiers!`,window.T_Reset_view=`R√©initialiser la vue`,window.T_View_reset=`Vue r√©initialis√©e!`,window.T_No_results_found=`Aucun r√©sultat trouv√© pour "{0}"`,window.T_N_results_found=`{1} r√©sultats trouv√©s pour "{0}"`</script></head><body class="mobile-support html disableInlineCopyToClipboard" data-url=../../chapter3-old/1-lifespan/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><button class=topbar-control onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Table des mati√®res (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><ul><li><a href=#port√©e-dune-variable-locale>Port√©e d&rsquo;une variable locale</a></li><li><a href=#destruction-dun-objet>Destruction d&rsquo;un objet</a></li><li><a href=#dur√©e-de-vie-dun-objet>Dur√©e de vie d&rsquo;un objet</a></li><li><a href=#validit√©-dun-objet>Validit√© d&rsquo;un objet</a></li><li><a href=#lien-avec-la-m√©moire>Lien avec la m√©moire</a></li></ul></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=../../index.html><span itemprop=name>Accueil</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Gestion m√©moire</span><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Dur√©e de vie</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=../../index.html title="Accueil (ü°ê)"><i class="fa-fw fas fa-chevron-left"></i></a></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><a class=topbar-control href=../../chapter3-old/2-ownership/index.html title="Ownership (ü°í)"><i class="fa-fw fas fa-chevron-right"></i></a></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><button class=topbar-control onclick=toggleTopbarFlyout(this) type=button title="Aller plus loin"><i class="fa-fw fas fa-ellipsis-v"></i></button><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable chapter3-old" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=dur√©e-de-vie>Dur√©e de vie</h1><hr><h3 id=port√©e-dune-variable-locale>Port√©e d&rsquo;une variable locale</h3><p>Afin de parler de dur√©e de vie, nous allons commencer par parler de la port√©e de nos variables.
Comme vous le savez peut-√™tre, la port√©e d&rsquo;une variable d√©finit la portion de code dans laquelle le compilateur nous permet de l&rsquo;utiliser.</p><p>Si on d√©finit une variable dans une fonction, la port√©e de celle-ci d√©marre √† sa d√©finition et se termine √† la fin du bloc dans lequel celle-ci a √©t√© d√©finie.</p><div class="highlight wrap-code" linenos=inline><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=ln> 1</span><span class=cl> <span class=kt>void</span> <span class=nf>fcn</span><span class=p>(</span><span class=kt>int</span> <span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl> <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>     <span class=k>if</span> <span class=p>(</span><span class=n>a</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>     <span class=p>{</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>         <span class=kt>char</span> <span class=n>b</span> <span class=o>=</span> <span class=sc>&#39;0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>         <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>b</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>     <span class=p>}</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>     <span class=k>else</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>     <span class=p>{</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>         <span class=kt>char</span> <span class=n>c</span> <span class=o>=</span> <span class=sc>&#39;1&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>         <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>c</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>     <span class=p>}</span>
</span></span><span class=line><span class=ln>13</span><span class=cl> <span class=p>}</span></span></span></code></pre></div><p>Dans le code ci-dessus :</p><ul><li>la port√©e de <code>a</code> d√©marre √† la ligne 1 et termine √† la ligne 13,</li><li>la port√©e de <code>b</code> d√©marre √† la ligne 5 et termine √† la ligne 7,</li><li>la port√©e de <code>c</code> d√©marre √† la ligne 10 et termine √† la ligne 12.</li></ul><hr><h3 id=destruction-dun-objet>Destruction d&rsquo;un objet</h3><p>Supposons que nous ayions une classe <code>Class</code> et que l&rsquo;on d√©clare une variable de ce type.</p><p>Lorsque cette variable sort du scope, une fonction sp√©ciale de <code>Class</code> est appel√©e.<br>On appelle celle-ci le <strong>destructeur</strong> de l&rsquo;objet.<br>Le nom de cette fonction est le nom de la classe pr√©c√©d√© d&rsquo;un tilde et acceptant 0 param√®tre :</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// dans le header
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>Class</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>~</span><span class=n>Class</span><span class=p>();</span>  <span class=c1>// destructeur de Class.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// dans le cpp
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Class</span><span class=o>::~</span><span class=n>Class</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// impl√©mentation du destructeur de Class.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span></span></span></code></pre></div><p>Comme pour le constructeur par d√©faut, le constructeur de copie ou l&rsquo;op√©rateur d&rsquo;assignation, le compilateur d√©finit une impl√©mentation par d√©faut du destructeur de chaque classe.<br>Ainsi, m√™me si nous n&rsquo;avons jusqu&rsquo;ici jamais eu √† d√©finir de destructeur pour nos classes, le destructeur existait bel et bien et √©tait appel√© √† chaque fois qu&rsquo;il le devait.</p><hr><h3 id=dur√©e-de-vie-dun-objet>Dur√©e de vie d&rsquo;un objet</h3><p>Revenons √† la notion de dur√©e de vie.
La dur√©e de vie d&rsquo;un objet d√©marre de l&rsquo;appel de son constructeur et termine √† l&rsquo;appel de son destructeur.</p><p>Lorsque l&rsquo;on d√©finit une variable locale contenant une instance d&rsquo;objet, sa dur√©e de vie correspond par cons√©quent √† la port√©e de la variable dans laquelle celui-ci est plac√©.</p><div class="highlight wrap-code" linenos=inline><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=ln> 1</span><span class=cl> <span class=kt>void</span> <span class=nf>fcn</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>param</span><span class=p>)</span>                <span class=c1>// construction de param
</span></span></span><span class=line><span class=ln> 2</span><span class=cl><span class=c1></span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>     <span class=k>if</span> <span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>     <span class=p>{</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>         <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>empty</span> <span class=o>=</span> <span class=s>&#34;empty&#34;</span><span class=p>;</span>       <span class=c1>// construction de empty
</span></span></span><span class=line><span class=ln> 6</span><span class=cl><span class=c1></span>         <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>empty</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>     <span class=p>}</span>                                      <span class=c1>// destruction de empty
</span></span></span><span class=line><span class=ln> 8</span><span class=cl><span class=c1></span>     <span class=k>else</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>     <span class=p>{</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>         <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>filled</span> <span class=o>=</span> <span class=s>&#34;filled&#34;</span><span class=p>;</span>     <span class=c1>// construction de filled
</span></span></span><span class=line><span class=ln>11</span><span class=cl><span class=c1></span>         <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>filled</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>     <span class=p>}</span>                                      <span class=c1>// destruction de filled
</span></span></span><span class=line><span class=ln>13</span><span class=cl><span class=c1></span> <span class=p>}</span>                                          <span class=c1>// destruction de param
</span></span></span></code></pre></div><p>Dans le code ci-dessus :</p><ul><li>la port√©e et la dur√©e de vie de <code>param</code> d√©marre √† la ligne 1 et termine √† la ligne 13,</li><li>la port√©e et la dur√©e de vie de <code>empty</code> d√©marre √† la ligne 5 et termine √† la ligne 7,</li><li>la port√©e et la dur√©e de vie de <code>filled</code> d√©marre √† la ligne 10 et termine √† la ligne 12.</li></ul><p><strong>Qu&rsquo;en est-il de la dur√©e de vie d&rsquo;un objet d√©fini en tant qu&rsquo;attribut d&rsquo;une autre classe ?</strong></p><p>Pour le d√©terminer, vous allez modifier le code du programme <code>c3-1-box</code>.</p><p>Modifiez le constructeur de la classe <code>Box</code> et red√©finissez son destructeur afin qu&rsquo;ils affichent <code>Box created</code> et <code>Box destroyed</code>.<br>Faites de m√™me pour <code>Content</code> et testez le programme.<br>Pouvez-vous en d√©duire √† quel moment la dur√©e de vie de <code>_content</code> d√©marre, et √† quel moment celle-ci termine ?</p><div class=expand><input type=checkbox id=R-expand-d8af068da9ad43e2d04b9f66e0c11ff1 aria-controls=R-expandcontent-d8af068da9ad43e2d04b9f66e0c11ff1>
<label class=expand-label for=R-expand-d8af068da9ad43e2d04b9f66e0c11ff1><i class="expander-icon fa-fw fas fa-chevron-down"></i>
<i class="expander-icon fa-fw fas fa-chevron-right"></i> Solution</label><div id=R-expandcontent-d8af068da9ad43e2d04b9f66e0c11ff1 class=expand-content><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>struct</span> <span class=nc>Content</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Content</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span> <span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>:</span> <span class=n>name</span> <span class=p>{</span> <span class=n>name</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Content created&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>~</span><span class=n>Content</span><span class=p>()</span> <span class=p>{</span> <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Content destroyed&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Box</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Box</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span> <span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>:</span> <span class=n>_content</span> <span class=p>{</span> <span class=n>name</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Box created&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>~</span><span class=n>Box</span><span class=p>()</span> <span class=p>{</span> <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Box destroyed&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>Content</span><span class=o>&amp;</span> <span class=n>get_content</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>_content</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Content</span> <span class=n>_content</span> <span class=p>{</span> <span class=s>&#34;thing&#34;</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></div><p>On obtient la sortie suivante :</p><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-b data-lang=b><span class=line><span class=cl><span class=c>box1 block begin
</span></span></span><span class=line><span class=cl><span class=c>Content created
</span></span></span><span class=line><span class=cl><span class=c>Box created
</span></span></span><span class=line><span class=cl><span class=c>Box destroyed
</span></span></span><span class=line><span class=cl><span class=c>Content destroyed
</span></span></span><span class=line><span class=cl><span class=c></span><span class=nb>----------------</span><span class=c>
</span></span></span><span class=line><span class=cl><span class=c>box2 block begin
</span></span></span><span class=line><span class=cl><span class=c>Content created
</span></span></span><span class=line><span class=cl><span class=c>Box created
</span></span></span><span class=line><span class=cl><span class=c>Box destroyed
</span></span></span><span class=line><span class=cl><span class=c>Content destroyed
</span></span></span><span class=line><span class=cl><span class=c>box2 block end</span></span></span></code></pre></div><p>On peut en d√©duire que <code>Box::_content</code> :<br>- est construit pendant l&rsquo;appel du constructeur de <code>Box</code>, juste avant de rentrer dans le corps de la fonction,<br>- est d√©truit pendant l&rsquo;appel du destructeur <code>Box</code>, juste apr√®s √™tre sorti du corps de la fonction.</p></div></div><hr><h3 id=validit√©-dun-objet>Validit√© d&rsquo;un objet</h3><p>La dur√©e de vie d&rsquo;un objet d√©termine la p√©riode durant laquelle il est valide d&rsquo;utiliser cet objet et son contenu.</p><p>En C++, il est possible de cr√©er des objets dynamiquement avec les mots-clefs <code>new</code> et <code>delete</code>.<br>Testez le code suivant et d√©terminez les dur√©es de vie des objets <code>box</code> et <code>box->_content</code> √† partir de l&rsquo;output du programme.<div class="highlight wrap-code" linenos=inline><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=ln> 1</span><span class=cl> <span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl> <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>     <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Main begin&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl> 
</span></span><span class=line><span class=ln> 5</span><span class=cl>     <span class=n>Box</span><span class=o>*</span> <span class=n>box</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Box</span><span class=p>(</span><span class=s>&#34;gift&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>     <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>box</span><span class=o>-&gt;</span><span class=n>get_content</span><span class=p>().</span><span class=n>name</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>     <span class=k>delete</span> <span class=n>box</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl> 
</span></span><span class=line><span class=ln> 9</span><span class=cl>     <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Main end&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>     <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>11</span><span class=cl> <span class=p>}</span></span></span></code></pre></div></p><div class=expand><input type=checkbox id=R-expand-49d8e1ba3149bac6c575c0c08bd01608 aria-controls=R-expandcontent-49d8e1ba3149bac6c575c0c08bd01608>
<label class=expand-label for=R-expand-49d8e1ba3149bac6c575c0c08bd01608><i class="expander-icon fa-fw fas fa-chevron-down"></i>
<i class="expander-icon fa-fw fas fa-chevron-right"></i> Solution</label><div id=R-expandcontent-49d8e1ba3149bac6c575c0c08bd01608 class=expand-content><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-b data-lang=b><span class=line><span class=cl><span class=c>Main begin
</span></span></span><span class=line><span class=cl><span class=c>Content created
</span></span></span><span class=line><span class=cl><span class=c>Box created
</span></span></span><span class=line><span class=cl><span class=c>gift
</span></span></span><span class=line><span class=cl><span class=c>Box destroyed
</span></span></span><span class=line><span class=cl><span class=c>Content destroyed
</span></span></span><span class=line><span class=cl><span class=c>Main end</span></span></span></code></pre></div><p>Les dur√©es de vie des objets <code>box</code> et <code>box->_content</code> d√©marrent √† la ligne 5 (<code>new</code>) et s&rsquo;ach√®vent √† la ligne 7 (<code>delete</code>).</p></div></div><p>Analysez maintenant le code ci-dessous.<br>Quelle est selon vous la dur√©e de vie de la variable <code>content</code> ?<div class="highlight wrap-code" linenos=inline><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=ln> 1</span><span class=cl> <span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl> <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>     <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Main start&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl> 
</span></span><span class=line><span class=ln> 5</span><span class=cl>     <span class=n>Box</span><span class=o>*</span> <span class=n>box</span>        <span class=o>=</span> <span class=k>new</span> <span class=n>Box</span><span class=p>(</span><span class=s>&#34;gift&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>     <span class=n>Content</span> <span class=n>content</span> <span class=o>=</span> <span class=n>box</span><span class=o>-&gt;</span><span class=n>get_content</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl> 
</span></span><span class=line><span class=ln> 8</span><span class=cl>     <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>content</span><span class=p>.</span><span class=n>name</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl> 
</span></span><span class=line><span class=ln>10</span><span class=cl>     <span class=k>delete</span> <span class=n>box</span><span class=p>;</span>
</span></span><span class=line><span class=ln>11</span><span class=cl> 
</span></span><span class=line><span class=ln>12</span><span class=cl>     <span class=n>content</span><span class=p>.</span><span class=n>name</span> <span class=o>=</span> <span class=s>&#34;chocolate&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>     <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>content</span><span class=p>.</span><span class=n>name</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=ln>14</span><span class=cl> 
</span></span><span class=line><span class=ln>15</span><span class=cl>     <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Main end&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>     <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>17</span><span class=cl> <span class=p>}</span></span></span></code></pre></div></p><p>Testez le code pour v√©rifier ce qu&rsquo;il se passe r√©ellement.</p><p>Pour mieux comprendre, vous allez red√©finir le constructeur de copie de <code>Content</code> afin qu&rsquo;il affiche <code>Content copied</code>.
Combien d&rsquo;objets de type <code>Content</code> ont donc √©t√© cr√©√©s par le programme pr√©c√©dent ? Quelles √©taient leurs dur√©es de vie respectives ?</p><div class=expand><input type=checkbox id=R-expand-009853c30509165c7cc2f4fb7226a033 aria-controls=R-expandcontent-009853c30509165c7cc2f4fb7226a033>
<label class=expand-label for=R-expand-009853c30509165c7cc2f4fb7226a033><i class="expander-icon fa-fw fas fa-chevron-down"></i>
<i class="expander-icon fa-fw fas fa-chevron-right"></i> Solution</label><div id=R-expandcontent-009853c30509165c7cc2f4fb7226a033 class=expand-content><div class="highlight wrap-code"><pre tabindex=0 class=chroma><code class=language-b data-lang=b><span class=line><span class=cl><span class=c>Main start
</span></span></span><span class=line><span class=cl><span class=c>Content created
</span></span></span><span class=line><span class=cl><span class=c>Box created
</span></span></span><span class=line><span class=cl><span class=c>Content copied
</span></span></span><span class=line><span class=cl><span class=c>gift
</span></span></span><span class=line><span class=cl><span class=c>Box destroyed
</span></span></span><span class=line><span class=cl><span class=c>Content destroyed
</span></span></span><span class=line><span class=cl><span class=c>chocolate
</span></span></span><span class=line><span class=cl><span class=c>Main end
</span></span></span><span class=line><span class=cl><span class=c>Content destroyed</span></span></span></code></pre></div><p>Deux objets de type <code>Content</code> ont √©t√© cr√©√©s par le programme.<br>La dur√©e de vie du premier, <code>box->_content</code>, d√©marre √† la ligne 5 (construction de <code>*box</code>) et termine √† la ligne 10 (destruction de <code>*box</code>).<br>La dur√©e de vie du second, <code>content</code>, d√©marre √† la ligne 6 (copie de <code>box->_content</code>) et termine √† la ligne 17 (sortie du <code>main</code>).</p></div></div><p>Analysez enfin le code suivant.<br>Quelle est maintenant la dur√©e de vie de <code>content_ref</code> ? A votre avis, que peut-il se passer lors de l&rsquo;ex√©cution de la ligne 12 ?<br>Commentez ensuite la ligne 12 et retestez une derni√®re fois le programme.<div class="highlight wrap-code" linenos=inline><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=ln> 1</span><span class=cl> <span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl> <span class=p>{</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl>     <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Main start&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl> 
</span></span><span class=line><span class=ln> 5</span><span class=cl>     <span class=n>Box</span><span class=o>*</span> <span class=n>box</span>             <span class=o>=</span> <span class=k>new</span> <span class=n>Box</span><span class=p>(</span><span class=s>&#34;gift&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>     <span class=n>Content</span><span class=o>&amp;</span> <span class=n>content_ref</span> <span class=o>=</span> <span class=n>box</span><span class=o>-&gt;</span><span class=n>get_content</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl> 
</span></span><span class=line><span class=ln> 8</span><span class=cl>     <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>content_ref</span><span class=p>.</span><span class=n>name</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl> 
</span></span><span class=line><span class=ln>10</span><span class=cl>     <span class=k>delete</span> <span class=n>box</span><span class=p>;</span>
</span></span><span class=line><span class=ln>11</span><span class=cl> 
</span></span><span class=line><span class=ln>12</span><span class=cl>     <span class=n>content_ref</span><span class=p>.</span><span class=n>name</span> <span class=o>=</span> <span class=s>&#34;chocolate&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>     <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>content_ref</span><span class=p>.</span><span class=n>name</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=ln>14</span><span class=cl> 
</span></span><span class=line><span class=ln>15</span><span class=cl>     <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Main end&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=ln>16</span><span class=cl>     <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=ln>17</span><span class=cl> <span class=p>}</span></span></span></code></pre></div></p><div class=expand><input type=checkbox id=R-expand-46c436b4364c981f21fe35d810b881cb aria-controls=R-expandcontent-46c436b4364c981f21fe35d810b881cb>
<label class=expand-label for=R-expand-46c436b4364c981f21fe35d810b881cb><i class="expander-icon fa-fw fas fa-chevron-down"></i>
<i class="expander-icon fa-fw fas fa-chevron-right"></i> Solution</label><div id=R-expandcontent-46c436b4364c981f21fe35d810b881cb class=expand-content><p>Comme <code>content_ref</code> est une r√©f√©rence, la variable correspond au m√™me objet que <code>box->_content</code>.
Sa dur√©e de vie s&rsquo;√©tend donc de la ligne 5 √† la ligne 10 du programme.</p><p>De mon c√¥t√©, le programme d√©clenche forc√©ment une segfault.<br>Lorsque la ligne 12 est comment√©e, le programme crashe sur la ligne 13 (acc√®s √† <code>content_ref.name</code>) et lorsqu&rsquo;elle est d√©comment√©, il crashe √† la sortie du programme.</p><p>En r√©alit√©, on est dans une situation qualifi√©e d&rsquo;<strong>undefined behavior</strong>.
Le comportement exact du programme d√©pendra donc de votre compilateur et de la mani√®re dont votre syst√®me d&rsquo;exploitation g√®re les acc√®s m√©moire.</p></div></div><p>Les diff√©rents tests effectu√©s nous permettent de conclure les points suivants.<br>Tant qu&rsquo;on manipule des objets via des variables qui ne sont pas des r√©f√©rences, ces objets existent forc√©ment au moment de l&rsquo;utilisation et il n&rsquo;y a aucun risque d&rsquo;avoir un probl√®me.<br>En revanche, d√®s lors que l&rsquo;on manipule des objets via des r√©f√©rences, il est n√©cessaire d&rsquo;√™tre prudent, car la port√©e de la variable ne correspondra pas n√©cessairement √† la dur√©e de vie de l&rsquo;objet r√©f√©renc√©.</p><hr><h3 id=lien-avec-la-m√©moire>Lien avec la m√©moire</h3><p>La dur√©e de vie d&rsquo;un objet est √©troitement li√©e √† la m√©moire du programme.</p><p>Lorsqu&rsquo;on construit un objet dynamiquement, le programme demande au syst√®me d&rsquo;exploitation de r√©server une zone dans la m√©moire qui servira √† contenir les donn√©es de l&rsquo;objet.
Lorsque cet objet est d√©truit, le programme rend la m√©moire au syst√®me, qui pourra la r√©attribu√©e √† un autre processus.
Pour √©viter de corrompre les donn√©es des autres programmes, le syst√®me devrait emp√™cher votre programme d&rsquo;aller √©crire dans de la m√©moire lib√©r√©e en d√©clenchant une segfault.</p><p>C&rsquo;est donc pour cette raison que l&rsquo;on peut consid√©rer que la dur√©e de vie de l&rsquo;objet d√©finit la r√©gion du code dans laquelle il est valide de l&rsquo;utiliser.</p><footer class=footline></footer></article></div></main></div><aside id=R-sidebar class="default-animation showVisitedLinks"><div id=R-header-topbar class=default-animation></div><div id=R-header-wrapper class=default-animation><div id=R-header class=default-animation><a id=logo href=../../>üéÑ C++ üéÑ</a></div></div><div id=R-homelinks class=default-animation><hr class=padding></div><div id=R-content-wrapper class=highlightable><div id=R-topics><ul class="enlarge morespace collapsible-menu"><li data-nav-id=/chapter0/index.html><a class=padding href=../../chapter0/index.html><b>0- </b>Mise en place<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-bb41caf94f12b8a1a4b5e560230e7851 class=collapsible-menu></ul></li><li data-nav-id=/chapter1/index.html><a class=padding href=../../chapter1/index.html><b>1- </b>Introduction au C++<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-6c398714eae4372920aec3a1e6c2e143 class=collapsible-menu></ul></li><li data-nav-id=/chapter2/index.html><a class=padding href=../../chapter2/index.html><b>2- </b>Classes<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-b1df0095a9fd74320697a6d478418ec3 class=collapsible-menu></ul></li><li data-nav-id=/chapter3/index.html><a class=padding href=../../chapter3/index.html><b>3- </b>Cycle de vie<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-9f6546bce6f8e9a77063b71c880fd5b8 class=collapsible-menu></ul></li><li data-nav-id=/chapter4/index.html><a class=padding href=../../chapter4/index.html><b>4- </b>H√©ritage<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-48065e8b6e7e69533ca73b3931c8a0a1 class=collapsible-menu></ul></li><li data-nav-id=/chapter5/index.html><a class=padding href=../../chapter5/index.html><b>5- </b>Librairie standard<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-86528e6ba587b53932a1dafaa9cd375c class=collapsible-menu></ul></li><li data-nav-id=/chapter6/index.html><a class=padding href=../../chapter6/index.html><b>6- </b>Algorithmes<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-016ee40825ff7c4aeecbac08a8ca264b class=collapsible-menu></ul></li><li data-nav-id=/chapter9/index.html><a class=padding href=../../chapter9/index.html><b>7- </b>Templates<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-24ddf636ccd0ce3ef39c8060d1779332 class=collapsible-menu></ul></li><li data-nav-id=/chapter10/index.html><a class=padding href=../../chapter10/index.html><b>8- </b>Param√®tres de templates<i class="fa-fw fas fa-check read-icon"></i></a><ul id=R-subsections-66e6e0c58d73995ecc09e8fbbe358e51 class=collapsible-menu></ul></li></ul></div><div id=R-shortcuts><div class="nav-title padding">Acc√®s rapide</div><ul class=space><li><a class=padding href=https://github.com/Laefy/CPP_Learning_Code/><i class='fab fa-github'></i> D√©p√¥t Cours</a></li><li><a class=padding href=https://github.com/Laefy/CPP_Exercises/><i class='fab fa-github'></i> D√©p√¥t TPs</a></li><li><a class=padding href=../../slides/index.html><i class='far fa-file-powerpoint'></i> Slides</a></li><li><a class=padding href=../../workflow/index.html><i class='far fa-list-alt'></i> Workflow</a></li><li><a class=padding href=../../faq/index.html><i class='fas fa-question-circle'></i> FAQ</a></li><li><a class=padding href=../../chapter0/6-tips/index.html><i class='fa fa-rocket'></i> Astuces</a></li><li><a class=padding href=https://godbolt.org/><i class='fas fa-cog'></i> Compiler Explorer</a></li><li><a class=padding href=https://en.cppreference.com/w/><i class='fas fa-passport'></i> CPP-Ref</a></li></ul></div><div class="padding footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVisitedLinks showFooter"></div><div id=R-menu-footer><hr class="padding default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVisitedLinks showFooter"><div id=R-prefooter class="footerLangSwitch footerVariantSwitch footerVisitedLinks showVisitedLinks"><ul><li id=R-select-language-container class=footerLangSwitch><div class="padding menu-control"><i class="fa-fw fas fa-language"></i>
<span>&nbsp;</span><div class=control-style><label class=a11y-only for=R-select-language>Langue</label>
<select id=R-select-language onchange="location=this.querySelector(this.value).dataset.url"><option id=R-select-language-fr value=#R-select-language-fr data-url=../../chapter3-old/1-lifespan/index.html lang=fr selected>Fran√ßais</option></select></div><div class=clear></div></div></li><li id=R-select-variant-container class=footerVariantSwitch><div class="padding menu-control"><i class="fa-fw fas fa-paint-brush"></i>
<span>&nbsp;</span><div class=control-style><label class=a11y-only for=R-select-variant>Th√®me</label>
<select id=R-select-variant onchange=window.variants&&variants.changeVariant(this.value)><option id=R-select-variant-mine value=mine selected>Mine</option></select></div><div class=clear></div></div><script>window.variants&&variants.markSelectedVariant()</script></li><li class="footerVisitedLinks showVisitedLinks"><div class="padding menu-control"><i class="fa-fw fas fa-history"></i>
<span>&nbsp;</span><div class=control-style><button onclick=clearHistory()>Supprimer l'historique</button></div><div class=clear></div></div></li></ul></div><div id=R-footer class="footerFooter showFooter"><p>Built with <a href=https://github.com/McShelby/hugo-theme-relearn title=love><i class="fas fa-heart"></i></a> by <a href=https://gohugo.io/>Hugo</a></p></div></div></div></aside><script src=../../js/clipboard.min.js?1729268528 defer></script><script src=../../js/perfect-scrollbar.min.js?1729268528 defer></script><script src=../../js/theme.js?1729268528 defer></script><button id=footer-question-btn title="Envoyer un message √† propos du texte s√©lectionn√©" onclick=openQuestionForm() disabled><i class="fas fa-question-circle"></i></button><div id=footer-question-window disabled><form id=question method=POST action=https://formsubmit.co/3aa0f379a1aed9c454634cc2da153a7b target=question-submitted onsubmit=cleanQuestionFormContent()><input type=email name=email placeholder=mon_email@smthg.com required onchange=updateQuestionFormSubject()>
<textarea name=question rows=7 cols=30 placeholder="Mon message..."></textarea>
<input type=hidden name=selection>
<input type=hidden name=_replyto>
<input type=hidden name=_subject>
<input type=hidden name=_template value=box>
<input type=hidden name=_captcha value=false>
<input type=hidden name=_next value=//question-submitted/>
<input type=submit disabled style=display:none aria-hidden=true>
<input type=submit value=Envoyer></form><iframe class=hidden name=question-submitted src></iframe></div><script>function updateQuestionFormSubject(){let e=document.querySelector('#question>input[name="email"]').value;document.querySelector('#question>input[name="_subject"]').value="[C++][Chapitre 3] "+e+", retour sur ta question"}function cleanQuestionFormContent(){function e(e){e.value=e.value.replace(/\[\.\./g,"[ ..")}e(document.querySelector('#question>textarea[name="question"]')),e(document.querySelector('#question>input[name="selection"]'))}function openQuestionForm(){document.getElementById("footer-question-window").removeAttribute("disabled");var e=window.getSelection().toString();document.querySelector('#question>input[name="selection"]').value=e}function updateQuestionWidgetState(e){var t=document.getElementById("R-body-inner"),n=window.getSelection(),s=document.getElementById("footer-question-window");document.getElementById("footer-question-btn").disabled=n.isCollapsed||t==null||t.contains(n.anchorNode)==!1||t.contains(n.focusNode)==!1,e!==void 0&&e.type=="mouseup"&&s.contains(e.target)==!1&&s.contains(document.activeElement)==!1&&s.setAttribute("disabled",!0)}updateQuestionFormSubject(),document.onmouseup=document.onkeyup=document.onselectionchange=updateQuestionWidgetState,updateQuestionWidgetState()</script></body></html>